import{n as u,C as Z}from"./app-DfCwzo0T.js";import{M as L,a as $,C as g,Z as I,b as j,L as H}from"./index-Dxbj43yt.js";import{L as s,h as m}from"./mapHelpers-Cq6hfGFh.js";import{g as B}from"./glify-browser-MJT_iz9l.js";const Y={name:"GlobalMapNotification",props:{color:{type:String,default:"green"}}};var J=function(){var e=this,o=e._self._c;return o("div",{staticClass:"event",class:"event-"+e.color,on:{click:function(n){return e.$emit("click",n)}}},[o("div",{staticClass:"event-image"},[e._t("image")],2),o("div",{staticClass:"event-content"},[e._t("content")],2)])},W=[],q=u(Y,J,W,!1,null,"e06e593a");const v=q.exports,V={name:"CleanupCreated",props:["payload"],components:{GlobalMapNotification:v}};var X=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"green"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"-mt-2"},[o("i",{staticClass:"fa fa-users fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[o("p",[e._v("Cleanup created")]),o("i",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),o("strong",[e._v(e._s(e.payload.name))]),e._v("!")])]},proxy:!0}])})},K=[],Q=u(V,X,K,!1,null,"9c29fe7c");const ee=Q.exports,te={name:"ImageUploaded",props:["payload"],data(){return{dir:"/assets/icons/flags/"}},methods:{countryFlag(t){return t?this.dir+t.toLowerCase()+".png":""}},computed:{country(){var t;return(t=this.payload.country)!=null&&t.includes("error_")?null:this.payload.country},state(){var t;return(t=this.payload.state)!=null&&t.includes("error_")?null:this.payload.state},city(){var t;return(t=this.payload.city)!=null&&t.includes("error_")?null:this.payload.city},cityText(){let t=[this.city,this.state].filter(e=>e).join(", ");return t&&this.country&&(t+=", "),t},photoSource(){return this.payload.photoSource==="web"?"fa-desktop":"fa-mobile large-icon"}}};var oe=function(){var e=this,o=e._self._c;return o("div",{staticClass:"event",on:{click:function(n){return e.$emit("click",n)}}},[o("div",{staticClass:"top-heading"},[e.payload.countryCode?o("img",{attrs:{src:e.countryFlag(e.payload.countryCode),alt:e.payload.countryCode}}):o("i",{staticClass:"fa fa-image fa-2x"}),o("div",[o("p",{staticClass:"event-bold"},[e.payload.isPickedUp?o("span",[e._v(e._s(e.$t("home.globalMap.litter-picked-up")))]):o("span",[e._v(e._s(e.$t("home.globalMap.litter-uploaded")))])]),o("p",{staticClass:"event-location"},[o("i",{staticClass:"city-name"},[e._v(e._s(e.cityText))]),e._v(e._s(e.country)+" ")])]),o("div",{staticClass:"event-source"},[o("i",{staticClass:"fa",class:e.photoSource})])]),e.payload.user.name||e.payload.user.username?o("p",[e._v(" "+e._s(e.$t("locations.cityVueMap.by"))+" "),o("span",{staticClass:"event-bold"},[e._v(" "+e._s(e.payload.user.name)+" "+e._s(e.payload.user.username?"@"+e.payload.user.username:"")+" ")])]):e._e(),e.payload.teamName?o("p",{staticClass:"event-team"},[e._v(" "+e._s(e.$t("common.team"))+" "),o("span",{staticClass:"event-bold"},[e._v(e._s(e.payload.teamName))])]):e._e()])},ne=[],se=u(te,oe,ne,!1,null,"a5896d9f");const ae=se.exports,re="/build/assets/mining-Cq36pFOM.png",ie={name:"LittercoinMined",components:{GlobalMapNotification:v},props:["payload"],methods:{getLittercoinReason(t){if(t==="verified-box")return this.$i18n.t("home.globalMap.littercoin-100-boxes-verified");if(t==="100-images-verified")return this.$i18n.t("home.globalMap.littercoin-100-verified")}}};var le=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"littercoin"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"flex items-center h-full"},[o("img",{staticClass:"ltr-icon",attrs:{src:re,alt:"Mining"}})])]},proxy:!0},{key:"content",fn:function(){return[o("div",{staticClass:"flex items-center h-full"},[o("div",[o("p",[e._v(e._s(e.$t("home.globalMap.littercoin-mined")))]),o("i",[e._v(e._s(e.$t("common.reason"))+": "),o("span",{staticClass:"ltr-strong"},[e._v(e._s(e.getLittercoinReason(e.payload.reason)))])])])])]},proxy:!0}])})},ce=[],pe=u(ie,le,ce,!1,null,"6648b6f2");const ue=pe.exports,de={name:"NewCountryAdded",components:{GlobalMapNotification:v},props:["payload"]};var me=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"blue"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"-mt-2"},[o("i",{staticClass:"fa fa-flag fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[o("strong",[e._v(e._s(e.$t("home.globalMap.new-country")))]),o("p",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),o("i",[e._v(e._s(e.payload.country))])])]},proxy:!0}])})},he=[],fe=u(de,me,he,!1,null,"538454b0");const _e=fe.exports,ge={name:"NewStateAdded",components:{GlobalMapNotification:v},props:["payload"]};var ve=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"blue"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"-mt-2"},[o("i",{staticClass:"fa fa-flag fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[o("strong",[e._v(e._s(e.$t("home.globalMap.new-state")))]),o("p",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),o("i",[e._v(e._s(e.payload.state))])])]},proxy:!0}])})},ye=[],Ce=u(ge,ve,ye,!1,null,"ee01ceee");const Le=Ce.exports,we={name:"NewCityAdded",components:{GlobalMapNotification:v},props:["payload"]};var be=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"blue"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"-mt-2"},[o("i",{staticClass:"fa fa-flag fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[o("strong",[e._v(e._s(e.$t("home.globalMap.new-city")))]),o("p",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),o("i",[e._v(e._s(e.payload.city))])])]},proxy:!0}])})},$e=[],ke=u(we,be,$e,!1,null,"03289d8a");const Se=ke.exports,Me={name:"TeamCreated",components:{GlobalMapNotification:v},props:["payload"]};var Te=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"colourful"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"-mt-2"},[o("i",{staticClass:"fa fa-users fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[o("p",[e._v(e._s(e.$t("home.globalMap.team-created")))]),o("i",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),o("strong",[e._v(e._s(e.payload.teamName))]),e._v("!")])]},proxy:!0}])})},Ee=[],Oe=u(Me,Te,Ee,!1,null,"a390effa");const Ue=Oe.exports,Pe={name:"UserSignedUp",props:["payload"],components:{GlobalMapNotification:v}};var xe=function(){var e=this,o=e._self._c;return o("GlobalMapNotification",{attrs:{color:"yellow"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[o("div",{staticClass:"-mt-2"},[o("i",{staticClass:"fa fa-user fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[o("strong",[e._v(e._s(e.$t("home.globalMap.new-user")))]),o("p",[e._v(e._s(e.$t("home.globalMap.user-signed-up")))])]},proxy:!0}])})},De=[],Ge=u(Pe,xe,De,!1,null,"fd609b30");const Ie=Ge.exports,Ne={name:"live-events",components:{CleanupCreated:ee,ImageUploaded:ae,LittercoinMined:ue,NewCityAdded:Se,NewStateAdded:Le,NewCountryAdded:_e,TeamCreated:Ue,UserSignedUp:Ie},data(){return{events:[],clicks:0,timer:null}},created(){this.listenForEvents()},methods:{addEvent(t,e){this.events.unshift({id:new Date().getTime(),type:t,payload:e}),this.updateDocumentTitle()},click(t,e){this.clicks++,this.clicks===1?this.timer=setTimeout(()=>{this.flyToLocation(t),this.clicks=0},300):(clearTimeout(this.timer),this.removeEvent(e),this.clicks=0)},listenForEvents(){Echo.channel("main").listen(".App\\Events\\Cleanups\\CleanupCreated",t=>{this.addEvent("CleanupCreated",t)}).listen("ImageUploaded",t=>{this.addEvent("ImageUploaded",t)}).listen("NewCountryAdded",t=>{this.addEvent("NewCountryAdded",t)}).listen("NewStateAdded",t=>{this.addEvent("NewStateAdded",t)}).listen("NewCityAdded",t=>{this.addEvent("NewCityAdded",t)}).listen(".App\\Events\\Littercoin\\LittercoinMined",t=>{this.addEvent("LittercoinMined",t)}).listen("TeamCreated",t=>{this.addEvent("TeamCreated",t)}).listen("UserSignedUp",t=>{this.addEvent("UserSignedUp",t.now)})},flyToLocation(t){var e,o;(e=t.payload)!=null&&e.latitude&&((o=t.payload)!=null&&o.longitude)&&this.$emit("fly-to-location",{...t.payload,zoom:17})},removeEvent(t){this.events.splice(t,1),this.updateDocumentTitle()},updateDocumentTitle(){document.title=this.events.length>0?"("+this.events.length+") OpenLitterMap":"OpenLitterMap"}}};var Re=function(){var e=this,o=e._self._c;return o("div",{staticClass:"sidebar-menu scrollbar-hidden"},[o("transition-group",{attrs:{name:"list",mode:"out-in"}},e._l(e.events,function(n,l){return o("span",{key:n.id,staticClass:"list-item"},[o(n.type,{tag:"component",attrs:{payload:n.payload},on:{click:function(r){return e.click(n,l)}}})],1)}),0)],1)},Fe=[],Ae=u(Ne,Re,Fe,!1,null,null);const ze=Ae.exports,Ze={name:"SearchCustomTags",created(){this.debouncedInputHandler=this.debounce(this.searchForTags)},directives:{ClickOutside:Z},data(){return{search:"",open:!1,processing:!1,selectedTags:[]}},computed:{customTags(){return this.$store.state.globalmap.customTagsFound}},methods:{closeContainer(){this.open=!1},debounce(t){let e;return function(...o){clearTimeout(e),e=setTimeout(()=>{t.apply(this,o)},1e3)}},loadCustomTag(t){window.open("https://openlittermap.com/tags?custom_tags="+t)},async searchForTags(){this.processing=!0,await this.$store.dispatch("SEARCH_CUSTOM_TAGS",this.search),this.processing=!1}}};var je=function(){var e=this,o=e._self._c;return o("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.closeContainer,expression:"closeContainer"}],staticClass:"outer-container"},[o("div",{staticClass:"inner-container"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"input",attrs:{id:"search-custom-tags",placeholder:"Search custom tags"},domProps:{value:e.search},on:{click:function(n){e.open=!0},input:[function(n){n.target.composing||(e.search=n.target.value)},e.debouncedInputHandler]}}),e.open?o("div",{staticClass:"tags-container"},[e.customTags.length?e._l(this.customTags,function(n){return o("div",{staticClass:"tag-selection",on:{click:function(l){return e.loadCustomTag(n.tag)}}},[o("p",[e._v(e._s(n.tag)+" ("+e._s(n.total)+")")])])}):o("p",[e._v(" No results found. Try again later! ")])],2):e._e()])])},He=[],Be=u(Ze,je,He,!1,null,"539139af");const Ye=Be.exports,Je={initialize:function(){s.Control.Select=s.Control.extend({options:{position:"topright",iconMain:"≡",iconChecked:"◉",iconUnchecked:"ⵔ",iconGroupChecked:"▶",iconGroupUnchecked:"⊳",multi:!1,items:[],id:"",selectedDefault:!1,additionalClass:"",onOpen:()=>{},onClose:()=>{},onGroupOpen:t=>{},onSelect:t=>{}},initialize(t){this.menus=[],s.Util.setOptions(this,t);const e=this.options;this.options.items.forEach(r=>{r.label||(r.label=r.value)}),e.multi?e.selectedDefault=e.selectedDefault instanceof Array?e.selectedDefault:[]:e.selectedDefault=e.selectedDefault||(e.items instanceof Array&&e.items.length>0?e.items[0].value:!1),console.log(e.selectedDefault),this.state={selected:e.selectedDefault,open:!1};const o=r=>{this._isGroup(r)&&r.items.map(i=>{i.parent=r.value,o(i)})};this.options.items.map(r=>{r.parent="top",o(r)});const n=r=>{let i=[];return this._isGroup(r)&&r.items.map(c=>{i.push(c.value),i=i.concat(n(c))}),i},l=r=>{r.children=n(r),this._isGroup(r)&&r.items.map(i=>{l(i)})};this.options.items.map(r=>{l(r)})},onAdd(t){this.map=t;const e=this.options;this.container=s.DomUtil.create("div","leaflet-control leaflet-bar leaflet-control-select"),this.container.setAttribute("id",e.id);const o=s.DomUtil.create("a","leaflet-control-button ",this.container);return o.innerHTML=e.iconMain,t.on("click",this._hideMenu,this),s.DomEvent.on(o,"click",s.DomEvent.stop),s.DomEvent.on(o,"click",this._iconClicked,this),s.DomEvent.disableClickPropagation(this.container),s.DomEvent.disableScrollPropagation(this.container),this.render(),this.container},_emit(t,e){const o={};switch(t){case"ITEM_SELECT":this.options.multi?(o.selected=this.state.selected.slice(),this.state.selected.includes(e.item.value)?o.selected=o.selected.filter(n=>n!==e.item.value):o.selected.push(e.item.value)):o.selected=e.item.value,o.open=e.item.parent;break;case"GROUP_OPEN":o.open=e.item.value;break;case"GROUP_CLOSE":o.open=e.item.parent;break;case"MENU_OPEN":o.open="top";break;case"MENU_CLOSE":o.open=!1;break}this._setState(o),this.render()},_setState(t){this.options.onSelect&&t.selected&&(this.options.multi&&t.selected.length!==this.state.selected.length||!this.options.multi&&t.selected!==this.state.selected)&&this.options.onSelect(t.selected),this.options.onGroupOpen&&t.open&&t.open!==this.state.open&&(console.log("group open"),this.options.onGroupOpen(t.open)),this.options.onOpen&&t.open==="top"&&this.options.onOpen(),this.options.onClose&&!t.open&&this.options.onClose(),this.state=Object.assign(this.state,t)},_isGroup(t){return"items"in t},_isSelected(t){const e=this.state.selected;return e?this._isGroup(t)?"children"in t?this.options.multi?e.find(o=>t.children.includes(o)):t.children.includes(e):!1:this.options.multi?e.indexOf(t.value)>-1:e===t.value:!1},_isOpen(t){const e=this.state.open;return e&&(e===t.value||t.children.includes(e))},_hideMenu(){this._emit("MENU_CLOSE",{})},_iconClicked(){this._emit("MENU_OPEN",{})},_itemClicked(t){this._isGroup(t)?this.state.open===t.value?this._emit("GROUP_CLOSE",{item:t}):this._emit("GROUP_OPEN",{item:t}):this._emit("ITEM_SELECT",{item:t})},_renderRadioIcon(t,e){const o=s.DomUtil.create("span","radio icon",e);o.innerHTML=t?this.options.iconChecked:this.options.iconUnchecked},_renderGroupIcon(t,e){const o=s.DomUtil.create("span","group icon",e);o.innerHTML=t?this.options.iconGroupChecked:this.options.iconGroupUnchecked},_renderItem(t,e){const o=this._isSelected(t),n=s.DomUtil.create("div","leaflet-control-select-menu-line",e),l=s.DomUtil.create("div","leaflet-control-select-menu-line-content",n),r=s.DomUtil.create("span","text",l);return r.innerHTML=t.label,this._isGroup(t)?(this._renderGroupIcon(o,l),s.DomUtil.addClass(n,"group"),this._isOpen(t)&&s.DomUtil.addClass(n,"group-opened"),this._isOpen(t)&&this._renderMenu(n,t.items)):this._renderRadioIcon(o,l),s.DomEvent.addListener(l,"click",i=>{this._itemClicked(t)}),n},_renderMenu(t,e){const o=s.DomUtil.create("div","leaflet-control-select-menu leaflet-bar ",t);this.menus.push(o),e.map(n=>{this._renderItem(n,o)})},_clearMenus(){this.menus.map(t=>t.remove()),this.meus=[]},render(){this._clearMenus(),this.state.open&&this._renderMenu(this.container,this.options.items)},close(){this._hideMenu()}}),s.control.select=t=>new s.Control.Select(t)}};var a,f,k,U,_,y=L,S,M=null,w,C,T=!1,E=!1;const P=s.icon({iconUrl:"/images/vendor/leaflet/dist/dot.png",iconSize:[10,10]}),F=s.icon({iconUrl:"/images/vendor/leaflet/dist/grey-dot.jpg",iconSize:[13,10]});function We(t,e){const o=[e.lng,e.lat];return t.properties.verified===2?s.marker(o,{icon:P}):s.marker(o,{icon:F})}function N(t,e){return s.marker(e,{icon:P})}function qe(t,e){if(!t.properties.cluster)return t.properties.verified===2?s.marker(e,{icon:P}):s.marker(e,{icon:F});const o=t.properties.point_count,n=o<j?"small":o<H?"medium":"large",l=s.divIcon({html:'<div class="mi"><span class="ma">'+t.properties.point_count_abbreviated+"</span></div>",className:"marker-cluster-"+n,iconSize:s.point(40,40)});return s.marker(e,{icon:l})}function R(){T&&(a.removeControl(w),T=!1),E||(C=s.control.layers(null,null).addTo(a),C.addOverlay(f,"Global"),C.addOverlay(U,"Litter Art"),S&&C.addOverlay(S,"Cleanups"),k&&C.addOverlay(k,"Merchants"),E=!0)}function Ve(){if(E&&(a.removeControl(C),E=!1),!T){const t={Alcohol:new s.LayerGroup,Brands:new s.LayerGroup,Coastal:new s.LayerGroup,Coffee:new s.LayerGroup,Dumping:new s.LayerGroup,Food:new s.LayerGroup,Industrial:new s.LayerGroup,Other:new s.LayerGroup,PetSurprise:new s.LayerGroup,Sanitary:new s.LayerGroup,Smoking:new s.LayerGroup,SoftDrinks:new s.LayerGroup};w=s.control.layers(null,t).addTo(a),T=!0}}function Xe(t,e){t.properties.cluster&&e.on("click",function(o){const n=a.getZoom()+I>$?$:a.getZoom()+I;a.flyTo(o.latlng,n,{animate:!0,duration:2})})}function Ke(t,e){e.on("click",function(o){a.flyTo(t.geometry.coordinates,14,{animate:!0,duration:10});const n=new URL(window.location.href);n.searchParams.set("lat",t.geometry.coordinates[0]),n.searchParams.set("lon",t.geometry.coordinates[1]),n.searchParams.set("zoom",g),n.searchParams.set("photo",t.properties.photo_id),s.popup(m.popupOptions).setLatLng(t.geometry.coordinates).setContent(m.getMapImagePopupContent(t.properties,n.toString())).openOn(a)})}function Qe(t,e){e.on("click",function(o){const n=[t.geometry.coordinates[1],t.geometry.coordinates[0]];a.flyTo(n,14,{animate:!0,duration:10});const l=m.getCleanupContent(t.properties,M);s.popup(m.popupOptions).setLatLng(n).setContent(l).openOn(a)})}function et(t,e){e.on("click",function(o){const n=[t.geometry.coordinates[1],t.geometry.coordinates[0]];a.flyTo(n,14,{animate:!0,duration:10});const l=m.getMerchantContent(t.properties,M);s.popup(m.popupOptions).setLatLng(n).setContent(l).openOn(a),new Swiper(".swiper-container",{navigation:{prevEl:"#prevButton",nextEl:"#nextButton"}})})}function tt(){let t=[];return w._layerControlInputs.forEach((e,o)=>{if(e.checked){const n=w._layers[o].name.toLowerCase()==="petsurprise"?"dogshit":w._layers[o].name.toLowerCase();t.push(n)}}),t.length>0?t:null}const ot={name:"Supercluster",components:{SearchCustomTags:Ye,LiveEvents:ze},props:{activeLayer:{default:"clusters",required:!1}},data(){return{visiblePoints:[]}},mounted(){var n,l,r;window.olm_map=this,a=s.map("openlittermap",{center:[0,0],zoom:L,scrollWheelZoom:!1,smoothWheelZoom:!0,smoothSensitivity:2}),a.scrollWheelZoom=!0,this.flyToLocationFromURL();const e=new Date().getFullYear();if(s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data &copy; "+'<a href="https://openstreetmap.org">OpenStreetMap</a>'+" & Contributors",maxZoom:$,minZoom:L}).addTo(a),a.attributionControl.addAttribution("Litter data &copy OpenLitterMap & Contributors "+e+" Clustering @ MapBox"),f=s.geoJSON(null,{pointToLayer:qe,onEachFeature:Xe}),(n=this.$store.state.globalmap.geojson)!=null&&n.features&&f.addData(this.$store.state.globalmap.geojson.features),this.activeLayer==="clusters"&&f.addTo(a),U=s.geoJSON(null,{pointToLayer:We,onEachFeature:Ke}),(r=(l=this.$store.state.globalmap)==null?void 0:l.artData)!=null&&r.features&&U.addData(this.$store.state.globalmap.artData.features),this.$store.state.cleanups.geojson&&(S=s.geoJSON(this.$store.state.cleanups.geojson,{onEachFeature:Qe,pointToLayer:N})),this.activeLayer==="cleanups"&&(S.addTo(a),a.on("click",function(i){const c=i.latlng.lat,p=i.latlng.lng;window.olm_map.$store.commit("setCleanupLocation",{lat:c,lng:p})}),this.$route.params.hasOwnProperty("invite_link"))){const i=this.$store.state.cleanups.cleanup,c=[i.lat,i.lon];a.flyTo(c,16,{animate:!0,duration:5});const p=this.$store.state.user.auth?this.$store.state.user.user.id:null;s.popup(m.popupOptions).setLatLng(c).setContent(m.getCleanupContent(i,p)).openOn(a)}this.$store.state.user.auth&&(M=this.$store.state.user.user.id),Object.keys(this.$store.state.merchants.geojson).length>0&&(k=s.geoJSON(this.$store.state.merchants.geojson,{onEachFeature:et,pointToLayer:N})),this.activeLayer==="merchants"&&(k.addTo(a),a.on("click",function(i){const c=i.latlng.lat,p=i.latlng.lng;window.olm_map.$store.commit("setMerchantLocation",{lat:c,lng:p})})),this.$store.state.user.auth&&(M=this.$store.state.user.user.id),a.on("moveend",this.update),R(),a.on("overlayadd",this.update),a.on("overlayremove",this.update),a.on("popupopen",m.scrollPopupToBottom),a.on("popupclose",()=>{const i=new URL(window.location.href);i.searchParams.delete("photo"),window.history.pushState(null,"",i)}),a.on("zoom",()=>{_!=null&&_.remove&&_.remove()}),this.setupYearDropdown()},methods:{async update(){this.updateLocationInURL();const t=a.getBounds(),e={left:t.getWest(),bottom:t.getSouth(),right:t.getEast(),top:t.getNorth()},o=Math.round(a.getZoom());if(o===2&&o===y||o===3&&o===y||o===4&&o===y||o===5&&o===y)return;_&&(f.clearLayers(),_.remove());const n=new URLSearchParams(window.location.search),l=parseInt(n.get("year"))||null,r=n.get("fromDate")||null,i=n.get("toDate")||null,c=n.get("username")||null;if(o<g){R();const p=new URL(window.location.href);p.searchParams.delete("fromDate"),p.searchParams.delete("toDate"),p.searchParams.delete("username"),p.searchParams.delete("photo"),window.history.pushState(null,"",p),await axios.get("/global/clusters",{params:{zoom:o,bbox:e,year:l}}).then(d=>{console.log("get_clusters.update",d),f.clearLayers(),f.addData(d.data)}).catch(d=>{console.error("get_clusters.update",d)})}else{Ve();const p=tt();await axios.get("/global/points",{params:{zoom:o,bbox:e,layers:p,year:l,fromDate:r,toDate:i,username:c}}).then(d=>{console.log("get_global_points",d),this.visiblePoints=d.data.features,y<g&&f.clearLayers();const A=d.data.features.map(h=>[h.geometry.coordinates[0],h.geometry.coordinates[1]]);_=B.points({map:a,data:A,size:10,color:{r:.054,g:.819,b:.27,a:1},click:(h,b,rt)=>{const O=d.data.features.find(G=>G.geometry.coordinates[0]===b[0]&&G.geometry.coordinates[1]===b[1]);if(!O)return;const D=new URL(window.location.href);return D.searchParams.set("photo",O.properties.photo_id),window.history.pushState(null,"",D),this.renderLeafletPopup(O,h.latlng)}});let z=new URLSearchParams(window.location.search),x=parseInt(z.get("photo"));if(x){if(!this.visiblePoints.length)return;const h=this.visiblePoints.find(b=>b.properties.photo_id===x);h&&this.renderLeafletPopup(h,[h.geometry.coordinates[0],h.geometry.coordinates[1]])}}).catch(d=>{console.error("get_global_points",d)})}y=o},renderLeafletPopup(t,e){const o=new URL(window.location.href);o.searchParams.set("lat",t.geometry.coordinates[0]),o.searchParams.set("lon",t.geometry.coordinates[1]),o.searchParams.set("zoom",g),o.searchParams.set("photo",t.properties.photo_id),s.popup(m.popupOptions).setLatLng(e).setContent(m.getMapImagePopupContent(t.properties,o.toString())).openOn(a)},flyToLocationFromURL(){let t=new URLSearchParams(window.location.search),e=parseFloat(t.get("lat")||0),o=parseFloat(t.get("lon")||0),n=parseFloat(t.get("zoom")||L),l=parseInt(t.get("photo"));e=e<-85||e>85?0:e,o=o<-180||o>180?0:o,n=n<2||n>$?L:n,!(e===0&&o===0&&n===2)&&this.flyToLocation({latitude:e,longitude:o,zoom:n,photoId:l})},updateUrlPhotoIdAndFlyToLocation(t){const e=Math.round(a.getZoom()),o=new URL(window.location.href);o.searchParams.set("photo",t.photoId),window.history.pushState(null,"",o);const n=a.distance(a.getCenter(),[t.latitude,t.longitude]);e>=g&&n<=2e3?this.flyToLocation({...t,duration:1}):this.flyToLocation(t)},flyToLocation(t){const e=s.latLng(t.latitude,t.longitude),o=t.photoId&&Math.round(t.zoom)<g?g:t.zoom,n=a.getSize(),l=a.project(e,o),r=n.y*.4,i=l.subtract([0,r]),c=a.unproject(i,o);a.flyTo(c,o,{animate:!0,duration:t.duration??5})},updateLocationInURL(){const t=a.getCenter(),e=new URL(window.location.href);e.searchParams.set("lat",t.lat),e.searchParams.set("lon",t.lng),e.searchParams.set("zoom",a.getZoom()),window.history.pushState(null,"",e)},setupYearDropdown(){Je.initialize();let t=[{label:"All Time",value:"*"}];for(let o=new Date().getFullYear();o>=2017;o--)t.push({label:o.toString(),value:o.toString()});let e=parseInt(new URLSearchParams(window.location.search).get("year"))||"*";s.control.select({position:"topleft",selectedDefault:e.toString(),items:t,onSelect:function(o){const n=new URL(window.location.href);o==="*"?n.searchParams.delete("year"):n.searchParams.set("year",o),window.history.pushState(null,"",n),window.location.reload()}}).addTo(a)}}};var nt=function(){var e=this,o=e._self._c;return o("div",{staticClass:"h100"},[o("div",{ref:"openlittermap",attrs:{id:"openlittermap"}}),o("SearchCustomTags"),o("LiveEvents",{on:{"fly-to-location":e.updateUrlPhotoIdAndFlyToLocation}})],1)},st=[],at=u(ot,nt,st,!1,null,null);const ut=at.exports;export{ut as S};
