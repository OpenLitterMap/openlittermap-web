import{n as p,C as Z}from"./app-tO_qeCI9.js";import{M as L,a as $,C as g,Z as R,b as j,L as H}from"./index-Dxbj43yt.js";import{L as s,h as m}from"./mapHelpers-Zd4gi_d1.js";import{g as B}from"./glify-browser-BnwlG2_h.js";const Y={name:"ImageUploaded",props:["payload"],data(){return{dir:"/assets/icons/flags/"}},methods:{countryFlag(o){return o?this.dir+o.toLowerCase()+".png":""}},computed:{country(){var o;return(o=this.payload.country)!=null&&o.includes("error_")?null:this.payload.country},state(){var o;return(o=this.payload.state)!=null&&o.includes("error_")?null:this.payload.state},city(){var o;return(o=this.payload.city)!=null&&o.includes("error_")?null:this.payload.city},cityText(){let o=[this.city,this.state].filter(e=>e).join(", ");return o&&this.country&&(o+=", "),o},photoSource(){return this.payload.photoSource==="web"?"fa-desktop":"fa-mobile large-icon"}}};var J=function(){var e=this,t=e._self._c;return t("div",{staticClass:"event",on:{click:function(n){return e.$emit("click",n)}}},[t("div",{staticClass:"top-heading"},[e.payload.countryCode?t("img",{attrs:{src:e.countryFlag(e.payload.countryCode),alt:e.payload.countryCode}}):t("i",{staticClass:"fa fa-image fa-2x"}),t("div",[t("p",{staticClass:"event-bold"},[e.payload.isPickedUp?t("span",[e._v(e._s(e.$t("home.globalMap.litter-picked-up")))]):t("span",[e._v(e._s(e.$t("home.globalMap.litter-uploaded")))])]),t("p",{staticClass:"event-location"},[t("i",{staticClass:"city-name"},[e._v(e._s(e.cityText))]),e._v(e._s(e.country)+" ")])]),t("div",{staticClass:"event-source"},[t("i",{staticClass:"fa",class:e.photoSource})])]),e.payload.user.name||e.payload.user.username?t("p",[e._v(" "+e._s(e.$t("locations.cityVueMap.by"))+" "),t("span",{staticClass:"event-bold"},[e._v(" "+e._s(e.payload.user.name)+" "+e._s(e.payload.user.username?"@"+e.payload.user.username:"")+" ")])]):e._e(),e.payload.teamName?t("p",{staticClass:"event-team"},[e._v(" "+e._s(e.$t("common.team"))+" "),t("span",{staticClass:"event-bold"},[e._v(e._s(e.payload.teamName))])]):e._e()])},W=[],q=p(Y,J,W,!1,null,"a5896d9f");const V=q.exports,X={name:"GlobalMapNotification",props:{color:{type:String,default:"green"}}};var K=function(){var e=this,t=e._self._c;return t("div",{staticClass:"event",class:"event-"+e.color,on:{click:function(n){return e.$emit("click",n)}}},[t("div",{staticClass:"event-image"},[e._t("image")],2),t("div",{staticClass:"event-content"},[e._t("content")],2)])},Q=[],ee=p(X,K,Q,!1,null,"e06e593a");const v=ee.exports,te={name:"NewCountryAdded",components:{GlobalMapNotification:v},props:["payload"]};var oe=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"blue"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"-mt-2"},[t("i",{staticClass:"fa fa-flag fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[t("strong",[e._v(e._s(e.$t("home.globalMap.new-country")))]),t("p",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),t("i",[e._v(e._s(e.payload.country))])])]},proxy:!0}])})},ne=[],se=p(te,oe,ne,!1,null,"538454b0");const ae=se.exports,re={name:"NewStateAdded",components:{GlobalMapNotification:v},props:["payload"]};var ie=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"blue"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"-mt-2"},[t("i",{staticClass:"fa fa-flag fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[t("strong",[e._v(e._s(e.$t("home.globalMap.new-state")))]),t("p",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),t("i",[e._v(e._s(e.payload.state))])])]},proxy:!0}])})},le=[],ce=p(re,ie,le,!1,null,"ee01ceee");const pe=ce.exports,ue={name:"NewCityAdded",components:{GlobalMapNotification:v},props:["payload"]};var de=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"blue"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"-mt-2"},[t("i",{staticClass:"fa fa-flag fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[t("strong",[e._v(e._s(e.$t("home.globalMap.new-city")))]),t("p",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),t("i",[e._v(e._s(e.payload.city))])])]},proxy:!0}])})},me=[],he=p(ue,de,me,!1,null,"03289d8a");const fe=he.exports,_e={name:"UserSignedUp",props:["payload"],components:{GlobalMapNotification:v}};var ge=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"yellow"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"-mt-2"},[t("i",{staticClass:"fa fa-user fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[t("strong",[e._v(e._s(e.$t("home.globalMap.new-user")))]),t("p",[e._v(e._s(e.$t("home.globalMap.user-signed-up")))])]},proxy:!0}])})},ve=[],ye=p(_e,ge,ve,!1,null,"fd609b30");const Ce=ye.exports,Le={name:"TeamCreated",components:{GlobalMapNotification:v},props:["payload"]};var we=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"colourful"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"-mt-2"},[t("i",{staticClass:"fa fa-users fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[t("p",[e._v(e._s(e.$t("home.globalMap.team-created")))]),t("i",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),t("strong",[e._v(e._s(e.payload.teamName))]),e._v("!")])]},proxy:!0}])})},be=[],$e=p(Le,we,be,!1,null,"a390effa");const ke=$e.exports,Se="/build/assets/mining-Cq36pFOM.png",Me={name:"LittercoinMined",components:{GlobalMapNotification:v},props:["payload"],methods:{getLittercoinReason(o){if(o==="verified-box")return this.$i18n.t("home.globalMap.littercoin-100-boxes-verified");if(o==="100-images-verified")return this.$i18n.t("home.globalMap.littercoin-100-verified")}}};var Te=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"littercoin"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"flex items-center h-full"},[t("img",{staticClass:"ltr-icon",attrs:{src:Se,alt:"Mining"}})])]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"flex items-center h-full"},[t("div",[t("p",[e._v(e._s(e.$t("home.globalMap.littercoin-mined")))]),t("i",[e._v(e._s(e.$t("common.reason"))+": "),t("span",{staticClass:"ltr-strong"},[e._v(e._s(e.getLittercoinReason(e.payload.reason)))])])])])]},proxy:!0}])})},Oe=[],Ue=p(Me,Te,Oe,!1,null,"6648b6f2");const Pe=Ue.exports,Ee={name:"CleanupCreated",props:["payload"],components:{GlobalMapNotification:v}};var xe=function(){var e=this,t=e._self._c;return t("GlobalMapNotification",{attrs:{color:"green"},on:{click:function(n){return e.$emit("click",n)}},scopedSlots:e._u([{key:"image",fn:function(){return[t("div",{staticClass:"-mt-2"},[t("i",{staticClass:"fa fa-users fa-fw"})])]},proxy:!0},{key:"content",fn:function(){return[t("p",[e._v("Cleanup created")]),t("i",[e._v(e._s(e.$t("home.globalMap.say-hello-to"))+" "),t("strong",[e._v(e._s(e.payload.name))]),e._v("!")])]},proxy:!0}])})},De=[],Ge=p(Ee,xe,De,!1,null,"9c29fe7c");const Re=Ge.exports,Ie={name:"live-events",components:{UserSignedUp:Ce,ImageUploaded:V,NewCityAdded:fe,NewStateAdded:pe,NewCountryAdded:ae,TeamCreated:ke,LittercoinMined:Pe,CleanupCreated:Re},data(){return{events:[],clicks:0,timer:null}},channel:"main",created(){this.listenForEvents()},methods:{listenForEvents(){Echo.channel("main").listen("UserSignedUp",o=>{this.addEvent("UserSignedUp",o)})},addEvent(o,e){this.events.unshift({id:new Date().getTime(),type:"UserSignedUp",payload:e.now}),this.updateDocumentTitle()},click(o,e){this.clicks++,this.clicks===1?this.timer=setTimeout(()=>{this.flyToLocation(o),this.clicks=0},300):(clearTimeout(this.timer),this.removeEvent(e),this.clicks=0)},removeEvent(o){this.events.splice(o,1),this.updateDocumentTitle()},flyToLocation(o){var e,t;(e=o.payload)!=null&&e.latitude&&((t=o.payload)!=null&&t.longitude)&&this.$emit("fly-to-location",{...o.payload,zoom:17})},updateDocumentTitle(){document.title=this.events.length>0?"("+this.events.length+") OpenLitterMap":"OpenLitterMap"}}};var Fe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sidebar-menu scrollbar-hidden"},[t("transition-group",{attrs:{name:"list",mode:"out-in"}},e._l(e.events,function(n,l){return t("span",{key:n.id,staticClass:"list-item"},[t(n.type,{tag:"component",attrs:{payload:n.payload},on:{click:function(r){return e.click(n,l)}}})],1)}),0)],1)},Ne=[],ze=p(Ie,Fe,Ne,!1,null,null);const Ae=ze.exports,Ze={name:"SearchCustomTags",created(){this.debouncedInputHandler=this.debounce(this.searchForTags)},directives:{ClickOutside:Z},data(){return{search:"",open:!1,processing:!1,selectedTags:[]}},computed:{customTags(){return this.$store.state.globalmap.customTagsFound}},methods:{closeContainer(){this.open=!1},debounce(o){let e;return function(...t){clearTimeout(e),e=setTimeout(()=>{o.apply(this,t)},1e3)}},loadCustomTag(o){window.open("https://openlittermap.com/tags?custom_tags="+o)},async searchForTags(){this.processing=!0,await this.$store.dispatch("SEARCH_CUSTOM_TAGS",this.search),this.processing=!1}}};var je=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.closeContainer,expression:"closeContainer"}],staticClass:"outer-container"},[t("div",{staticClass:"inner-container"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"input",attrs:{id:"search-custom-tags",placeholder:"Search custom tags"},domProps:{value:e.search},on:{click:function(n){e.open=!0},input:[function(n){n.target.composing||(e.search=n.target.value)},e.debouncedInputHandler]}}),e.open?t("div",{staticClass:"tags-container"},[e.customTags.length?e._l(this.customTags,function(n){return t("div",{staticClass:"tag-selection",on:{click:function(l){return e.loadCustomTag(n.tag)}}},[t("p",[e._v(e._s(n.tag)+" ("+e._s(n.total)+")")])])}):t("p",[e._v(" No results found. Try again later! ")])],2):e._e()])])},He=[],Be=p(Ze,je,He,!1,null,"539139af");const Ye=Be.exports,Je={initialize:function(){s.Control.Select=s.Control.extend({options:{position:"topright",iconMain:"≡",iconChecked:"◉",iconUnchecked:"ⵔ",iconGroupChecked:"▶",iconGroupUnchecked:"⊳",multi:!1,items:[],id:"",selectedDefault:!1,additionalClass:"",onOpen:()=>{},onClose:()=>{},onGroupOpen:o=>{},onSelect:o=>{}},initialize(o){this.menus=[],s.Util.setOptions(this,o);const e=this.options;this.options.items.forEach(r=>{r.label||(r.label=r.value)}),e.multi?e.selectedDefault=e.selectedDefault instanceof Array?e.selectedDefault:[]:e.selectedDefault=e.selectedDefault||(e.items instanceof Array&&e.items.length>0?e.items[0].value:!1),console.log(e.selectedDefault),this.state={selected:e.selectedDefault,open:!1};const t=r=>{this._isGroup(r)&&r.items.map(i=>{i.parent=r.value,t(i)})};this.options.items.map(r=>{r.parent="top",t(r)});const n=r=>{let i=[];return this._isGroup(r)&&r.items.map(u=>{i.push(u.value),i=i.concat(n(u))}),i},l=r=>{r.children=n(r),this._isGroup(r)&&r.items.map(i=>{l(i)})};this.options.items.map(r=>{l(r)})},onAdd(o){this.map=o;const e=this.options;this.container=s.DomUtil.create("div","leaflet-control leaflet-bar leaflet-control-select"),this.container.setAttribute("id",e.id);const t=s.DomUtil.create("a","leaflet-control-button ",this.container);return t.innerHTML=e.iconMain,o.on("click",this._hideMenu,this),s.DomEvent.on(t,"click",s.DomEvent.stop),s.DomEvent.on(t,"click",this._iconClicked,this),s.DomEvent.disableClickPropagation(this.container),s.DomEvent.disableScrollPropagation(this.container),this.render(),this.container},_emit(o,e){const t={};switch(o){case"ITEM_SELECT":this.options.multi?(t.selected=this.state.selected.slice(),this.state.selected.includes(e.item.value)?t.selected=t.selected.filter(n=>n!==e.item.value):t.selected.push(e.item.value)):t.selected=e.item.value,t.open=e.item.parent;break;case"GROUP_OPEN":t.open=e.item.value;break;case"GROUP_CLOSE":t.open=e.item.parent;break;case"MENU_OPEN":t.open="top";break;case"MENU_CLOSE":t.open=!1;break}this._setState(t),this.render()},_setState(o){this.options.onSelect&&o.selected&&(this.options.multi&&o.selected.length!==this.state.selected.length||!this.options.multi&&o.selected!==this.state.selected)&&this.options.onSelect(o.selected),this.options.onGroupOpen&&o.open&&o.open!==this.state.open&&(console.log("group open"),this.options.onGroupOpen(o.open)),this.options.onOpen&&o.open==="top"&&this.options.onOpen(),this.options.onClose&&!o.open&&this.options.onClose(),this.state=Object.assign(this.state,o)},_isGroup(o){return"items"in o},_isSelected(o){const e=this.state.selected;return e?this._isGroup(o)?"children"in o?this.options.multi?e.find(t=>o.children.includes(t)):o.children.includes(e):!1:this.options.multi?e.indexOf(o.value)>-1:e===o.value:!1},_isOpen(o){const e=this.state.open;return e&&(e===o.value||o.children.includes(e))},_hideMenu(){this._emit("MENU_CLOSE",{})},_iconClicked(){this._emit("MENU_OPEN",{})},_itemClicked(o){this._isGroup(o)?this.state.open===o.value?this._emit("GROUP_CLOSE",{item:o}):this._emit("GROUP_OPEN",{item:o}):this._emit("ITEM_SELECT",{item:o})},_renderRadioIcon(o,e){const t=s.DomUtil.create("span","radio icon",e);t.innerHTML=o?this.options.iconChecked:this.options.iconUnchecked},_renderGroupIcon(o,e){const t=s.DomUtil.create("span","group icon",e);t.innerHTML=o?this.options.iconGroupChecked:this.options.iconGroupUnchecked},_renderItem(o,e){const t=this._isSelected(o),n=s.DomUtil.create("div","leaflet-control-select-menu-line",e),l=s.DomUtil.create("div","leaflet-control-select-menu-line-content",n),r=s.DomUtil.create("span","text",l);return r.innerHTML=o.label,this._isGroup(o)?(this._renderGroupIcon(t,l),s.DomUtil.addClass(n,"group"),this._isOpen(o)&&s.DomUtil.addClass(n,"group-opened"),this._isOpen(o)&&this._renderMenu(n,o.items)):this._renderRadioIcon(t,l),s.DomEvent.addListener(l,"click",i=>{this._itemClicked(o)}),n},_renderMenu(o,e){const t=s.DomUtil.create("div","leaflet-control-select-menu leaflet-bar ",o);this.menus.push(t),e.map(n=>{this._renderItem(n,t)})},_clearMenus(){this.menus.map(o=>o.remove()),this.meus=[]},render(){this._clearMenus(),this.state.open&&this._renderMenu(this.container,this.options.items)},close(){this._hideMenu()}}),s.control.select=o=>new s.Control.Select(o)}};var a,f,k,P,_,y=L,S,M=null,w,C,T=!1,O=!1;const E=s.icon({iconUrl:"/images/vendor/leaflet/dist/dot.png",iconSize:[10,10]}),N=s.icon({iconUrl:"/images/vendor/leaflet/dist/grey-dot.jpg",iconSize:[13,10]});function We(o,e){const t=[e.lng,e.lat];return o.properties.verified===2?s.marker(t,{icon:E}):s.marker(t,{icon:N})}function I(o,e){return s.marker(e,{icon:E})}function qe(o,e){if(!o.properties.cluster)return o.properties.verified===2?s.marker(e,{icon:E}):s.marker(e,{icon:N});const t=o.properties.point_count,n=t<j?"small":t<H?"medium":"large",l=s.divIcon({html:'<div class="mi"><span class="ma">'+o.properties.point_count_abbreviated+"</span></div>",className:"marker-cluster-"+n,iconSize:s.point(40,40)});return s.marker(e,{icon:l})}function F(){T&&(a.removeControl(w),T=!1),O||(C=s.control.layers(null,null).addTo(a),C.addOverlay(f,"Global"),C.addOverlay(P,"Litter Art"),S&&C.addOverlay(S,"Cleanups"),k&&C.addOverlay(k,"Merchants"),O=!0)}function Ve(){if(O&&(a.removeControl(C),O=!1),!T){const o={Alcohol:new s.LayerGroup,Brands:new s.LayerGroup,Coastal:new s.LayerGroup,Coffee:new s.LayerGroup,Dumping:new s.LayerGroup,Food:new s.LayerGroup,Industrial:new s.LayerGroup,Other:new s.LayerGroup,PetSurprise:new s.LayerGroup,Sanitary:new s.LayerGroup,Smoking:new s.LayerGroup,SoftDrinks:new s.LayerGroup};w=s.control.layers(null,o).addTo(a),T=!0}}function Xe(o,e){o.properties.cluster&&e.on("click",function(t){const n=a.getZoom()+R>$?$:a.getZoom()+R;a.flyTo(t.latlng,n,{animate:!0,duration:2})})}function Ke(o,e){e.on("click",function(t){a.flyTo(o.geometry.coordinates,14,{animate:!0,duration:10});const n=new URL(window.location.href);n.searchParams.set("lat",o.geometry.coordinates[0]),n.searchParams.set("lon",o.geometry.coordinates[1]),n.searchParams.set("zoom",g),n.searchParams.set("photo",o.properties.photo_id),s.popup(m.popupOptions).setLatLng(o.geometry.coordinates).setContent(m.getMapImagePopupContent(o.properties,n.toString())).openOn(a)})}function Qe(o,e){e.on("click",function(t){const n=[o.geometry.coordinates[1],o.geometry.coordinates[0]];a.flyTo(n,14,{animate:!0,duration:10});const l=m.getCleanupContent(o.properties,M);s.popup(m.popupOptions).setLatLng(n).setContent(l).openOn(a)})}function et(o,e){e.on("click",function(t){const n=[o.geometry.coordinates[1],o.geometry.coordinates[0]];a.flyTo(n,14,{animate:!0,duration:10});const l=m.getMerchantContent(o.properties,M);s.popup(m.popupOptions).setLatLng(n).setContent(l).openOn(a),new Swiper(".swiper-container",{navigation:{prevEl:"#prevButton",nextEl:"#nextButton"}})})}function tt(){let o=[];return w._layerControlInputs.forEach((e,t)=>{if(e.checked){const n=w._layers[t].name.toLowerCase()==="petsurprise"?"dogshit":w._layers[t].name.toLowerCase();o.push(n)}}),o.length>0?o:null}const ot={name:"Supercluster",components:{SearchCustomTags:Ye,LiveEvents:Ae},props:{activeLayer:{default:"clusters",required:!1}},data(){return{visiblePoints:[]}},mounted(){var n,l,r;window.olm_map=this,a=s.map("openlittermap",{center:[0,0],zoom:L,scrollWheelZoom:!1,smoothWheelZoom:!0,smoothSensitivity:2}),a.scrollWheelZoom=!0,this.flyToLocationFromURL();const e=new Date().getFullYear();if(s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data &copy; "+'<a href="https://openstreetmap.org">OpenStreetMap</a>'+" & Contributors",maxZoom:$,minZoom:L}).addTo(a),a.attributionControl.addAttribution("Litter data &copy OpenLitterMap & Contributors "+e+" Clustering @ MapBox"),f=s.geoJSON(null,{pointToLayer:qe,onEachFeature:Xe}),(n=this.$store.state.globalmap.geojson)!=null&&n.features&&f.addData(this.$store.state.globalmap.geojson.features),this.activeLayer==="clusters"&&f.addTo(a),P=s.geoJSON(null,{pointToLayer:We,onEachFeature:Ke}),(r=(l=this.$store.state.globalmap)==null?void 0:l.artData)!=null&&r.features&&P.addData(this.$store.state.globalmap.artData.features),this.$store.state.cleanups.geojson&&(S=s.geoJSON(this.$store.state.cleanups.geojson,{onEachFeature:Qe,pointToLayer:I})),this.activeLayer==="cleanups"&&(S.addTo(a),a.on("click",function(i){const u=i.latlng.lat,c=i.latlng.lng;window.olm_map.$store.commit("setCleanupLocation",{lat:u,lng:c})}),this.$route.params.hasOwnProperty("invite_link"))){const i=this.$store.state.cleanups.cleanup,u=[i.lat,i.lon];a.flyTo(u,16,{animate:!0,duration:5});const c=this.$store.state.user.auth?this.$store.state.user.user.id:null;s.popup(m.popupOptions).setLatLng(u).setContent(m.getCleanupContent(i,c)).openOn(a)}this.$store.state.user.auth&&(M=this.$store.state.user.user.id),Object.keys(this.$store.state.merchants.geojson).length>0&&(k=s.geoJSON(this.$store.state.merchants.geojson,{onEachFeature:et,pointToLayer:I})),this.activeLayer==="merchants"&&(k.addTo(a),a.on("click",function(i){const u=i.latlng.lat,c=i.latlng.lng;window.olm_map.$store.commit("setMerchantLocation",{lat:u,lng:c})})),this.$store.state.user.auth&&(M=this.$store.state.user.user.id),a.on("moveend",this.update),F(),a.on("overlayadd",this.update),a.on("overlayremove",this.update),a.on("popupopen",m.scrollPopupToBottom),a.on("popupclose",()=>{const i=new URL(window.location.href);i.searchParams.delete("photo"),window.history.pushState(null,"",i)}),a.on("zoom",()=>{_!=null&&_.remove&&_.remove()}),this.setupYearDropdown()},methods:{async update(){this.updateLocationInURL();const o=a.getBounds(),e={left:o.getWest(),bottom:o.getSouth(),right:o.getEast(),top:o.getNorth()},t=Math.round(a.getZoom());if(t===2&&t===y||t===3&&t===y||t===4&&t===y||t===5&&t===y)return;_&&(f.clearLayers(),_.remove());const n=new URLSearchParams(window.location.search),l=parseInt(n.get("year"))||null,r=n.get("fromDate")||null,i=n.get("toDate")||null,u=n.get("username")||null;if(t<g){F();const c=new URL(window.location.href);c.searchParams.delete("fromDate"),c.searchParams.delete("toDate"),c.searchParams.delete("username"),c.searchParams.delete("photo"),window.history.pushState(null,"",c),await axios.get("/global/clusters",{params:{zoom:t,bbox:e,year:l}}).then(d=>{console.log("get_clusters.update",d),f.clearLayers(),f.addData(d.data)}).catch(d=>{console.error("get_clusters.update",d)})}else{Ve();const c=tt();await axios.get("/global/points",{params:{zoom:t,bbox:e,layers:c,year:l,fromDate:r,toDate:i,username:u}}).then(d=>{console.log("get_global_points",d),this.visiblePoints=d.data.features,y<g&&f.clearLayers();const z=d.data.features.map(h=>[h.geometry.coordinates[0],h.geometry.coordinates[1]]);_=B.points({map:a,data:z,size:10,color:{r:.054,g:.819,b:.27,a:1},click:(h,b,rt)=>{const U=d.data.features.find(G=>G.geometry.coordinates[0]===b[0]&&G.geometry.coordinates[1]===b[1]);if(!U)return;const D=new URL(window.location.href);return D.searchParams.set("photo",U.properties.photo_id),window.history.pushState(null,"",D),this.renderLeafletPopup(U,h.latlng)}});let A=new URLSearchParams(window.location.search),x=parseInt(A.get("photo"));if(x){if(!this.visiblePoints.length)return;const h=this.visiblePoints.find(b=>b.properties.photo_id===x);h&&this.renderLeafletPopup(h,[h.geometry.coordinates[0],h.geometry.coordinates[1]])}}).catch(d=>{console.error("get_global_points",d)})}y=t},renderLeafletPopup(o,e){const t=new URL(window.location.href);t.searchParams.set("lat",o.geometry.coordinates[0]),t.searchParams.set("lon",o.geometry.coordinates[1]),t.searchParams.set("zoom",g),t.searchParams.set("photo",o.properties.photo_id),s.popup(m.popupOptions).setLatLng(e).setContent(m.getMapImagePopupContent(o.properties,t.toString())).openOn(a)},flyToLocationFromURL(){let o=new URLSearchParams(window.location.search),e=parseFloat(o.get("lat")||0),t=parseFloat(o.get("lon")||0),n=parseFloat(o.get("zoom")||L),l=parseInt(o.get("photo"));e=e<-85||e>85?0:e,t=t<-180||t>180?0:t,n=n<2||n>$?L:n,!(e===0&&t===0&&n===2)&&this.flyToLocation({latitude:e,longitude:t,zoom:n,photoId:l})},updateUrlPhotoIdAndFlyToLocation(o){const e=Math.round(a.getZoom()),t=new URL(window.location.href);t.searchParams.set("photo",o.photoId),window.history.pushState(null,"",t);const n=a.distance(a.getCenter(),[o.latitude,o.longitude]);e>=g&&n<=2e3?this.flyToLocation({...o,duration:1}):this.flyToLocation(o)},flyToLocation(o){const e=[o.latitude,o.longitude],t=o.photoId&&Math.round(o.zoom)<g?g:o.zoom;a.flyTo(e,t,{animate:!0,duration:o.duration??5})},updateLocationInURL(){const o=a.getCenter(),e=new URL(window.location.href);e.searchParams.set("lat",o.lat),e.searchParams.set("lon",o.lng),e.searchParams.set("zoom",a.getZoom()),window.history.pushState(null,"",e)},setupYearDropdown(){Je.initialize();let o=[{label:"All Time",value:"*"}];for(let t=new Date().getFullYear();t>=2017;t--)o.push({label:t.toString(),value:t.toString()});let e=parseInt(new URLSearchParams(window.location.search).get("year"))||"*";s.control.select({position:"topleft",selectedDefault:e.toString(),items:o,onSelect:function(t){const n=new URL(window.location.href);t==="*"?n.searchParams.delete("year"):n.searchParams.set("year",t),window.history.pushState(null,"",n),window.location.reload()}}).addTo(a)}}};var nt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"h100"},[t("div",{ref:"openlittermap",attrs:{id:"openlittermap"}}),t("SearchCustomTags"),t("LiveEvents",{on:{"fly-to-location":e.updateUrlPhotoIdAndFlyToLocation}})],1)},st=[],at=p(ot,nt,st,!1,null,null);const ut=at.exports;export{ut as S};
