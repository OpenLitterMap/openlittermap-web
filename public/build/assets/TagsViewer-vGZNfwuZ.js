import{L as s,h as m}from"./mapHelpers-DDDBRVsN.js";import"./leaflet.timedimension.control-DiHmF9tl.js";import{M as r,a as p}from"./index-Dxbj43yt.js";import{n as l}from"./app-CFZqWuKE.js";import"./moment-zH0z38ay.js";/* empty css            */delete s.Icon.Default.prototype._getIconUrl;s.Icon.Default.mergeOptions({iconRetinaUrl:new URL("/build/assets/marker-icon-2x-_ZA0WGCc.png",import.meta.url).href,iconUrl:new URL("/build/assets/marker-icon-hN30_KVU.png",import.meta.url).href,shadowUrl:new URL("/build/assets/marker-shadow-f7SaPCxT.png",import.meta.url).href});const c={name:"TagsViewer",data(){return{geojson:null,map:null,pointsLayer:null,timeLayer:null,player:null}},async mounted(){await this.load(),this.map=s.map("map",{center:[0,0],zoom:r,scrollWheelZoom:!1,smoothWheelZoom:!0,smoothSensitivity:1}),this.flyToLocationFromURL();const t=new Date().getFullYear();s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data &copy; "+'<a href="https://openstreetmap.org">OpenStreetMap</a>'+" & Contributors",maxZoom:p,minZoom:r}).addTo(this.map),this.map.attributionControl.addAttribution("Litter data &copy; OpenLitterMap & Contributors "+t);let o=new s.TimeDimension({});this.map.timeDimension=o,this.player=new s.TimeDimension.Player({transitionTime:1e3,loop:!0},o),this.player.on("play",()=>{var n;(n=this.map)!=null&&n.hasLayer(this.pointsLayer)&&this.map.removeLayer(this.pointsLayer)}),this.map.addControl(new s.Control.TimeDimension({player:this.player,timeDimension:o,timeSliderDragUpdate:!0,loopButton:!0,autoPlay:!1,minSpeed:5,maxSpeed:100})),this.pointsLayer=s.geoJSON(this.geojson,{pointToLayer:(n,i)=>s.marker([i.lng,i.lat]),onEachFeature:(n,i)=>{i.on("click",g=>{s.popup(m.popupOptions).setLatLng(n.geometry.coordinates).setContent(m.getMapImagePopupContent(n.properties)).openOn(this.map)})}}),this.timeLayer=s.timeDimension.layer.geoJson(this.pointsLayer,{updateTimeDimension:!0,updateTimeDimensionMode:"replace"}),this.pointsLayer.addTo(this.map),this.timeLayer.addTo(this.map),this.map.on("moveend",this.updateLocationInURL),this.map.on("popupopen",m.scrollPopupToBottom)},methods:{async load(){const e=new URLSearchParams(window.location.search),t=e.get("custom_tag"),a=e.get("brand"),o=e.get("custom_tags");await axios.get("/tags-search",{params:{custom_tag:t,custom_tags:o,brand:a}}).then(n=>{this.geojson=n.data}).catch(n=>{console.error("get_tags",n)})},flyToLocationFromURL(){const e=new URLSearchParams(window.location.search);let t=parseFloat(e.get("lat")||0),a=parseFloat(e.get("lon")||0),o=parseFloat(e.get("zoom")||r);if(t=t<-85||t>85?0:t,a=a<-180||a>180?0:a,o=o<r||o>p?r:o,t===0&&a===0&&o===r)return;const n=[t,a];this.map.flyTo(n,o,{animate:!0,duration:5})},updateLocationInURL(){const e=this.map.getCenter(),t=new URL(window.location.href);t.searchParams.set("lat",e.lat),t.searchParams.set("lon",e.lng),t.searchParams.set("zoom",this.map.getZoom()),window.history.pushState(null,"",t)}}};var h=function(){var t=this,a=t._self._c;return a("div",{staticClass:"map-container"},[a("div",{ref:"map",attrs:{id:"map"}})])},u=[],d=l(c,h,u,!1,null,null);const U=d.exports;export{U as default};
