import{l as T}from"./mapHelpers-BwpDWaTU.js";import{c as v}from"./app-DpqRw90N.js";var D={exports:{}},c={exports:{}},y;function b(){return y||(y=1,function(f){(function(d,n){f.exports?f.exports=n():(d.nezasa||(d.nezasa={}),d.nezasa.iso8601||(d.nezasa.iso8601=n()))})(v,function(){var d={Period:{}};d.version="0.2",d.Period.parse=function(m,_){return n(m,_)},d.Period.parseToTotalSeconds=function(m){for(var _=[31104e3,2592e3,604800,86400,3600,60,1],i=n(m),e=0,s=0;s<i.length;s++)e+=i[s]*_[s];return e},d.Period.isValid=function(m){try{return n(m),!0}catch{return!1}},d.Period.parseToString=function(m,_,i,e){var s=["","","","","","",""],t=n(m,e);_||(_=["year","month","week","day","hour","minute","second"]),i||(i=["years","months","weeks","days","hours","minutes","seconds"]);for(var a=0;a<t.length;a++)t[a]>0&&(t[a]==1?s[a]=t[a]+" "+_[a]:s[a]=t[a]+" "+i[a]);return s.join(" ").trim().replace(/[ ]{2,}/g," ")};function n(m,_){var i=_||!1,e=[2,3,4,5,7,8,9],s=[0,0,0,0,0,0,0],t=[0,12,4,7,24,60,60],a;if(m=m.toUpperCase(),m){if(typeof m!="string")throw new Error("Invalid iso8601 period string '"+m+"'")}else return s;if(a=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(m))for(var r=0;r<e.length;r++){var o=e[r];s[r]=a[o]?+a[o].replace(/[A-Za-z]+/g,""):0}else throw new Error("String '"+m+"' is not a valid ISO8601 period.");if(i)for(var r=s.length-1;r>0;r--)s[r]>=t[r]&&(s[r-1]=s[r-1]+Math.floor(s[r]/t[r]),s[r]=s[r]%t[r]);return s}return d})}(c)),c.exports}(function(f,d){(function(n,m){f.exports=n(T,b())})(function(n,m){if(typeof _>"u")var _={iso8601:m};return n.TimeDimension=(n.Layer||n.Class).extend({includes:n.Evented||n.Mixin.Events,initialize:function(i){n.setOptions(this,i),this._availableTimes=this._generateAvailableTimes(),this._currentTimeIndex=-1,this._loadingTimeIndex=-1,this._loadingTimeout=this.options.loadingTimeout||3e3,this._syncedLayers=[],this._availableTimes.length>0&&this.setCurrentTime(this.options.currentTime||this._getDefaultCurrentTime()),this.options.lowerLimitTime&&this.setLowerLimit(this.options.lowerLimitTime),this.options.upperLimitTime&&this.setUpperLimit(this.options.upperLimitTime)},getAvailableTimes:function(){return this._availableTimes},getCurrentTimeIndex:function(){return this._currentTimeIndex===-1?this._availableTimes.length-1:this._currentTimeIndex},getCurrentTime:function(){var i=-1;return this._loadingTimeIndex!==-1?i=this._loadingTimeIndex:i=this.getCurrentTimeIndex(),i>=0?this._availableTimes[i]:null},isLoading:function(){return this._loadingTimeIndex!==-1},setCurrentTimeIndex:function(i){var e=this._upperLimit||this._availableTimes.length-1,s=this._lowerLimit||0;if(i=Math.min(Math.max(s,i),e),!(i<0)){this._loadingTimeIndex=i;var t=this._availableTimes[i];this._checkSyncedLayersReady(this._availableTimes[this._loadingTimeIndex])?this._newTimeIndexLoaded():(this.fire("timeloading",{time:t}),setTimeout((function(a){a==this._loadingTimeIndex&&this._newTimeIndexLoaded()}).bind(this,i),this._loadingTimeout))}},_newTimeIndexLoaded:function(){if(this._loadingTimeIndex!==-1){var i=this._availableTimes[this._loadingTimeIndex];this._currentTimeIndex=this._loadingTimeIndex,this.fire("timeload",{time:i}),this._loadingTimeIndex=-1}},_checkSyncedLayersReady:function(i){for(var e=0,s=this._syncedLayers.length;e<s;e++)if(this._syncedLayers[e].isReady&&!this._syncedLayers[e].isReady(i))return!1;return!0},setCurrentTime:function(i){var e=this._seekNearestTimeIndex(i);this.setCurrentTimeIndex(e)},seekNearestTime:function(i){var e=this._seekNearestTimeIndex(i);return this._availableTimes[e]},nextTime:function(i,e){i||(i=1);var s=this._currentTimeIndex,t=this._upperLimit||this._availableTimes.length-1,a=this._lowerLimit||0;this._loadingTimeIndex>-1&&(s=this._loadingTimeIndex),s=s+i,s>t&&(e?s=a:s=t),s<a&&(e?s=t:s=a),this.setCurrentTimeIndex(s)},prepareNextTimes:function(i,e,s){i||(i=1);var t=this._currentTimeIndex,a=t;this._loadingTimeIndex>-1&&(t=this._loadingTimeIndex);for(var r=0,o=this._syncedLayers.length;r<o;r++)this._syncedLayers[r].setMinimumForwardCache&&this._syncedLayers[r].setMinimumForwardCache(e);for(var l=e,h=this._upperLimit||this._availableTimes.length-1,u=this._lowerLimit||0;l>0;){if(t=t+i,t>h)if(s)t=u;else break;if(t<u)if(s)t=h;else break;if(a===t)break;this.fire("timeloading",{time:this._availableTimes[t]}),l--}},getNumberNextTimesReady:function(i,e,s){i||(i=1);var t=this._currentTimeIndex;this._loadingTimeIndex>-1&&(t=this._loadingTimeIndex);for(var a=e,r=0,o=this._upperLimit||this._availableTimes.length-1,l=this._lowerLimit||0;a>0;){if(t=t+i,t>o)if(s)t=l;else{a=0,r=e;break}if(t<l)if(s)t=o;else{a=0,r=e;break}var h=this._availableTimes[t];this._checkSyncedLayersReady(h)&&r++,a--}return r},previousTime:function(i,e){this.nextTime(i*-1,e)},registerSyncedLayer:function(i){this._syncedLayers.push(i),i.on("timeload",this._onSyncedLayerLoaded,this)},unregisterSyncedLayer:function(i){var e=this._syncedLayers.indexOf(i);e!=-1&&this._syncedLayers.splice(e,1),i.off("timeload",this._onSyncedLayerLoaded,this)},_onSyncedLayerLoaded:function(i){i.time==this._availableTimes[this._loadingTimeIndex]&&this._checkSyncedLayersReady(i.time)&&this._newTimeIndexLoaded()},_generateAvailableTimes:function(){if(this.options.times)return n.TimeDimension.Util.parseTimesExpression(this.options.times);if(this.options.timeInterval){var i=n.TimeDimension.Util.parseTimeInterval(this.options.timeInterval),e=this.options.period||"P1D",s=this.options.validTimeRange||void 0;return n.TimeDimension.Util.explodeTimeRange(i[0],i[1],e,s)}else return[]},_getDefaultCurrentTime:function(){var i=this._seekNearestTimeIndex(new Date().getTime());return this._availableTimes[i]},_seekNearestTimeIndex:function(i){for(var e=0,s=this._availableTimes.length;e<s&&!(i<this._availableTimes[e]);e++);return e>0&&e--,e},setAvailableTimes:function(i,e){var s=this.getCurrentTime(),t=this.getLowerLimit(),a=this.getUpperLimit();if(e=="extremes"){var r=this.options.period||"P1D";this._availableTimes=n.TimeDimension.Util.explodeTimeRange(new Date(i[0]),new Date(i[i.length-1]),r)}else{var o=n.TimeDimension.Util.parseTimesExpression(i);if(this._availableTimes.length===0)this._availableTimes=o;else if(e=="intersect")this._availableTimes=n.TimeDimension.Util.intersect_arrays(o,this._availableTimes);else if(e=="union")this._availableTimes=n.TimeDimension.Util.union_arrays(o,this._availableTimes);else if(e=="replace")this._availableTimes=o;else throw"Merge available times mode not implemented: "+e}t&&this.setLowerLimit(t),a&&this.setUpperLimit(a),this.setCurrentTime(s),this.fire("availabletimeschanged",{availableTimes:this._availableTimes,currentTime:s})},getLowerLimit:function(){return this._availableTimes[this.getLowerLimitIndex()]},getUpperLimit:function(){return this._availableTimes[this.getUpperLimitIndex()]},setLowerLimit:function(i){var e=this._seekNearestTimeIndex(i);this.setLowerLimitIndex(e)},setUpperLimit:function(i){var e=this._seekNearestTimeIndex(i);this.setUpperLimitIndex(e)},setLowerLimitIndex:function(i){this._lowerLimit=Math.min(Math.max(i||0,0),this._upperLimit||this._availableTimes.length-1),this.fire("limitschanged",{lowerLimit:this._lowerLimit,upperLimit:this._upperLimit})},setUpperLimitIndex:function(i){this._upperLimit=Math.max(Math.min(i,this._availableTimes.length-1),this._lowerLimit||0),this.fire("limitschanged",{lowerLimit:this._lowerLimit,upperLimit:this._upperLimit})},getLowerLimitIndex:function(){return this._lowerLimit},getUpperLimitIndex:function(){return this._upperLimit}}),n.Map.addInitHook(function(){this.options.timeDimension&&(this.timeDimension=n.timeDimension(this.options.timeDimensionOptions||{}))}),n.timeDimension=function(i){return new n.TimeDimension(i)},n.TimeDimension.Util={getTimeDuration:function(i){if(typeof _>"u")throw"iso8601-js-period library is required for Leatlet.TimeDimension: https://github.com/nezasa/iso8601-js-period";return _.iso8601.Period.parse(i,!0)},addTimeDuration:function(i,e,s){typeof s>"u"&&(s=!0),(typeof e=="string"||e instanceof String)&&(e=this.getTimeDuration(e));var t=e.length,a=s?"getUTC":"get",r=s?"setUTC":"set";t>0&&e[0]!=0&&i[r+"FullYear"](i[a+"FullYear"]()+e[0]),t>1&&e[1]!=0&&i[r+"Month"](i[a+"Month"]()+e[1]),t>2&&e[2]!=0&&i[r+"Date"](i[a+"Date"]()+e[2]*7),t>3&&e[3]!=0&&i[r+"Date"](i[a+"Date"]()+e[3]),t>4&&e[4]!=0&&i[r+"Hours"](i[a+"Hours"]()+e[4]),t>5&&e[5]!=0&&i[r+"Minutes"](i[a+"Minutes"]()+e[5]),t>6&&e[6]!=0&&i[r+"Seconds"](i[a+"Seconds"]()+e[6])},subtractTimeDuration:function(i,e,s){(typeof e=="string"||e instanceof String)&&(e=this.getTimeDuration(e));for(var t=[],a=0,r=e.length;a<r;a++)t.push(-e[a]);this.addTimeDuration(i,t,s)},parseAndExplodeTimeRange:function(i,e){var s=i.split("/"),t=new Date(Date.parse(s[0])),a=new Date(Date.parse(s[1])),r=s.length>2&&s[2].length?s[2]:"P1D";return e!=null&&(r=e),this.explodeTimeRange(t,a,r)},explodeTimeRange:function(i,e,s,t){var a=this.getTimeDuration(s),r=[],o=new Date(i.getTime()),l=null,h=null,u=null,g=null;if(t!==void 0){var p=t.split("/");l=p[0].split(":")[0],h=p[0].split(":")[1],u=p[1].split(":")[0],g=p[1].split(":")[1]}for(;o<e;)(t===void 0||o.getUTCHours()>=l&&o.getUTCHours()<=u)&&(o.getUTCHours()!=l||o.getUTCMinutes()>=h)&&(o.getUTCHours()!=u||o.getUTCMinutes()<=g)&&r.push(o.getTime()),this.addTimeDuration(o,a);return o>=e&&r.push(e.getTime()),r},parseTimeInterval:function(i){var e=i.split("/");if(e.length!=2)throw"Incorrect ISO9601 TimeInterval: "+i;var s=Date.parse(e[0]),t=null,a=null;return isNaN(s)?(a=this.getTimeDuration(e[0]),t=Date.parse(e[1]),s=new Date(t),this.subtractTimeDuration(s,a,!0),t=new Date(t)):(t=Date.parse(e[1]),isNaN(t)?(a=this.getTimeDuration(e[1]),t=new Date(s),this.addTimeDuration(t,a,!0)):t=new Date(t),s=new Date(s)),[s,t]},parseTimesExpression:function(i,e){var s=[];if(!i)return s;if(typeof i=="string"||i instanceof String)for(var t=i.split(","),a,r,o=0,l=t.length;o<l;o++)a=t[o],a.split("/").length==3?s=s.concat(this.parseAndExplodeTimeRange(a,e)):(r=Date.parse(a),isNaN(r)||s.push(r));else s=i;return s.sort(function(h,u){return h-u})},intersect_arrays:function(i,e){for(var s=i.slice(0),t=e.slice(0),a=[];s.length>0&&t.length>0;)s[0]<t[0]?s.shift():(s[0]>t[0]||a.push(s.shift()),t.shift());return a},union_arrays:function(i,e){for(var s=i.slice(0),t=e.slice(0),a=[];s.length>0&&t.length>0;)s[0]<t[0]?a.push(s.shift()):s[0]>t[0]?a.push(t.shift()):(a.push(s.shift()),t.shift());return s.length>0?a=a.concat(s):t.length>0&&(a=a.concat(t)),a},sort_and_deduplicate:function(i){i=i.slice(0).sort();for(var e=[],s=null,t=0,a=i.length;t<a;t++)i[t]!==s&&(e.push(i[t]),s=i[t]);return e}},n.TimeDimension.Layer=(n.Layer||n.Class).extend({includes:n.Evented||n.Mixin.Events,options:{opacity:1,zIndex:1},initialize:function(i,e){n.setOptions(this,e||{}),this._map=null,this._baseLayer=i,this._currentLayer=null,this._timeDimension=this.options.timeDimension||null},addTo:function(i){return i.addLayer(this),this},onAdd:function(i){this._map=i,!this._timeDimension&&i.timeDimension&&(this._timeDimension=i.timeDimension),this._timeDimension.on("timeloading",this._onNewTimeLoading,this),this._timeDimension.on("timeload",this._update,this),this._timeDimension.registerSyncedLayer(this),this._update()},onRemove:function(i){this._timeDimension.unregisterSyncedLayer(this),this._timeDimension.off("timeloading",this._onNewTimeLoading,this),this._timeDimension.off("timeload",this._update,this),this.eachLayer(i.removeLayer,i),this._map=null},eachLayer:function(i,e){return i.call(e,this._baseLayer),this},setZIndex:function(i){return this.options.zIndex=i,this._baseLayer.setZIndex&&this._baseLayer.setZIndex(i),this._currentLayer&&this._currentLayer.setZIndex&&this._currentLayer.setZIndex(i),this},setOpacity:function(i){return this.options.opacity=i,this._baseLayer.setOpacity&&this._baseLayer.setOpacity(i),this._currentLayer&&this._currentLayer.setOpacity&&this._currentLayer.setOpacity(i),this},bringToBack:function(){if(this._currentLayer)return this._currentLayer.bringToBack(),this},bringToFront:function(){if(this._currentLayer)return this._currentLayer.bringToFront(),this},_onNewTimeLoading:function(i){this.fire("timeload",{time:i.time})},isReady:function(i){return!0},_update:function(){return!0},getBaseLayer:function(){return this._baseLayer},getBounds:function(){var i=new n.LatLngBounds;return this._currentLayer&&i.extend(this._currentLayer.getBounds?this._currentLayer.getBounds():this._currentLayer.getLatLng()),i}}),n.timeDimension.layer=function(i,e){return new n.TimeDimension.Layer(i,e)},n.TimeDimension.Layer.WMS=n.TimeDimension.Layer.extend({initialize:function(i,e){n.TimeDimension.Layer.prototype.initialize.call(this,i,e),this._timeCacheBackward=this.options.cacheBackward||this.options.cache||0,this._timeCacheForward=this.options.cacheForward||this.options.cache||0,this._wmsVersion=this.options.wmsVersion||this.options.version||i.options.version||"1.1.1",this._getCapabilitiesParams=this.options.getCapabilitiesParams||{},this._getCapabilitiesAlternateUrl=this.options.getCapabilitiesUrl||null,this._getCapabilitiesAlternateLayerName=this.options.getCapabilitiesLayerName||null,this._proxy=this.options.proxy||null,this._updateTimeDimension=this.options.updateTimeDimension||!1,this._setDefaultTime=this.options.setDefaultTime||!1,this._updateTimeDimensionMode=this.options.updateTimeDimensionMode||"intersect",this._period=this.options.period||null,this._layers={},this._defaultTime=0,this._availableTimes=[],this._capabilitiesRequested=!1,(this._updateTimeDimension||this.options.requestTimeFromCapabilities)&&this._requestTimeDimensionFromCapabilities(),this._baseLayer.on("load",(function(){this._baseLayer.setLoaded(!0),this.fire("timeload",{time:this._defaultTime})}).bind(this))},getEvents:function(){var i=n.bind(this._unvalidateCache,this);return{moveend:i,zoomend:i}},eachLayer:function(i,e){for(var s in this._layers)this._layers.hasOwnProperty(s)&&i.call(e,this._layers[s]);return n.TimeDimension.Layer.prototype.eachLayer.call(this,i,e)},_onNewTimeLoading:function(i){var e=this._getLayerForTime(i.time);this._map.hasLayer(e)||this._map.addLayer(e)},isReady:function(i){var e=this._getLayerForTime(i);return this.options.bounds&&this._map&&!this._map.getBounds().contains(this.options.bounds)?!0:e.isLoaded()},onAdd:function(i){n.TimeDimension.Layer.prototype.onAdd.call(this,i),this._availableTimes.length==0?this._requestTimeDimensionFromCapabilities():this._updateTimeDimensionAvailableTimes()},_update:function(){if(this._map){var i=this._timeDimension.getCurrentTime(),e=this._getLayerForTime(i);this._currentLayer==null&&(this._currentLayer=e),this._map.hasLayer(e)?this._showLayer(e,i):this._map.addLayer(e)}},setOpacity:function(i){n.TimeDimension.Layer.prototype.setOpacity.apply(this,arguments);for(var e in this._layers)this._layers.hasOwnProperty(e)&&this._layers[e].setOpacity&&this._layers[e].setOpacity(i)},setZIndex:function(i){n.TimeDimension.Layer.prototype.setZIndex.apply(this,arguments);for(var e in this._layers)this._layers.hasOwnProperty(e)&&this._layers[e].setZIndex&&this._layers[e].setZIndex(i)},setParams:function(i,e){n.extend(this._baseLayer.options,i),this._baseLayer.setParams&&this._baseLayer.setParams(i,e);for(var s in this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].setParams&&(this._layers[s].setLoaded(!1),this._layers[s].setParams(i,e));return this},_unvalidateCache:function(){var i=this._timeDimension.getCurrentTime();for(var e in this._layers)i!=e&&this._layers.hasOwnProperty(e)&&(this._layers[e].setLoaded(!1),this._layers[e].redraw())},_evictCachedTimes:function(i,e){var s=this._getLoadedTimes(),t=String(this._currentTime),a=s.indexOf(t),r=[];if(e>-1){var o=a-e;o>0&&(r=s.splice(0,o),this._removeLayers(r))}if(i>-1){a=s.indexOf(t);var o=s.length-a-i-1;o>0&&(r=s.splice(a+i+1,o),this._removeLayers(r))}},_showLayer:function(i,e){this._currentLayer&&this._currentLayer!==i&&this._currentLayer.hide(),i.show(),!(this._currentLayer&&this._currentLayer===i)&&(this._currentLayer=i,this._currentTime=e,this._evictCachedTimes(this._timeCacheForward,this._timeCacheBackward))},_getLayerForTime:function(i){if(i==0||i==this._defaultTime||i==null)return this._baseLayer;if(this._layers.hasOwnProperty(i))return this._layers[i];var e=this._getNearestTime(i);if(this._layers.hasOwnProperty(e))return this._layers[e];var s=this._createLayerForTime(e);return this._layers[i]=s,s.on("load",(function(t,a){t.setLoaded(!0),this._layers[a]||(this._layers[a]=t),this._timeDimension&&a==this._timeDimension.getCurrentTime()&&!this._timeDimension.isLoading()&&this._showLayer(t,a),this.fire("timeload",{time:a})}).bind(this,s,i)),s.onAdd=(function(t){Object.getPrototypeOf(this).onAdd.call(this,t),this.hide()}).bind(s),s},_createLayerForTime:function(i){var e=this._baseLayer.options;return e.time=new Date(i).toISOString(),new this._baseLayer.constructor(this._baseLayer.getURL(),e)},_getLoadedTimes:function(){var i=[];for(var e in this._layers)this._layers.hasOwnProperty(e)&&i.push(e);return i.sort(function(s,t){return s-t})},_removeLayers:function(i){for(var e=0,s=i.length;e<s;e++)this._map&&this._map.removeLayer(this._layers[i[e]]),delete this._layers[i[e]]},setMinimumForwardCache:function(i){i>this._timeCacheForward&&(this._timeCacheForward=i)},_requestTimeDimensionFromCapabilities:function(){if(!this._capabilitiesRequested){this._capabilitiesRequested=!0;var i=this._getCapabilitiesUrl();this._proxy&&(i=this._proxy+"?url="+encodeURIComponent(i));var e=new XMLHttpRequest;e.addEventListener("load",(function(s){var t=s.currentTarget.responseXML;t!==null&&(this._defaultTime=Date.parse(this._getDefaultTimeFromCapabilities(t)),this._setDefaultTime=this._setDefaultTime||this._timeDimension&&this._timeDimension.getAvailableTimes().length==0,this.setAvailableTimes(this._parseTimeDimensionFromCapabilities(t)),this._setDefaultTime&&this._timeDimension&&this._timeDimension.setCurrentTime(this._defaultTime))}).bind(this)),e.overrideMimeType("application/xml"),e.open("GET",i),e.send()}},_getCapabilitiesUrl:function(){var i=this._baseLayer.getURL();this._getCapabilitiesAlternateUrl&&(i=this._getCapabilitiesAlternateUrl);var e=n.extend({},this._getCapabilitiesParams,{request:"GetCapabilities",service:"WMS",version:this._wmsVersion});return i=i+n.Util.getParamString(e,i,e.uppercase),i},_parseTimeDimensionFromCapabilities:function(i){var e=i.querySelectorAll('Layer[queryable="1"]'),s=this._baseLayer.wmsParams.layers,t=null,a=null;return e.forEach(function(r){r.querySelector("Name").innerHTML===s&&(t=r)}),t&&(a=this._getTimesFromLayerCapabilities(t),a||(a=this._getTimesFromLayerCapabilities(t.parentNode))),a},_getTimesFromLayerCapabilities:function(i){for(var e=null,s=i.children,t=0,a=s.length;t<a;t++)if(!(s[t].nodeName!=="Extent"&&s[t].nodeName!=="Dimension")&&s[t].getAttribute("name")==="time"&&s[t].textContent.length){e=s[t].textContent.trim();break}return e},_getDefaultTimeFromCapabilities:function(i){var e=i.querySelectorAll('Layer[queryable="1"]'),s=this._baseLayer.wmsParams.layers,t=null;e.forEach(function(r){r.querySelector("Name").innerHTML===s&&(t=r)});var a=0;return t&&(a=this._getDefaultTimeFromLayerCapabilities(t),a==0&&(a=this._getDefaultTimeFromLayerCapabilities(t.parentNode))),a},_getDefaultTimeFromLayerCapabilities:function(i){for(var e=0,s=i.children,t=0,a=s.length;t<a;t++)if(!(s[t].nodeName!=="Extent"&&s[t].nodeName!=="Dimension")&&s[t].getAttribute("name")==="time"&&s[t].attributes.default&&s[t].attributes.default.textContent.length){e=s[t].attributes.default.textContent.trim();break}return e},setAvailableTimes:function(i){this._availableTimes=n.TimeDimension.Util.parseTimesExpression(i,this._period),this._updateTimeDimensionAvailableTimes()},_updateTimeDimensionAvailableTimes:function(){(this._timeDimension&&this._updateTimeDimension||this._timeDimension&&this._timeDimension.getAvailableTimes().length==0)&&(this._timeDimension.setAvailableTimes(this._availableTimes,this._updateTimeDimensionMode),this._setDefaultTime&&this._defaultTime>0&&this._timeDimension.setCurrentTime(this._defaultTime))},_getNearestTime:function(i){if(this._layers.hasOwnProperty(i)||this._availableTimes.length==0)return i;for(var e=0,s=this._availableTimes.length;e<s&&!(i<this._availableTimes[e]);e++);return e>0&&e--,i!=this._availableTimes[e],this._availableTimes[e]}}),n.NonTiledLayer||(n.NonTiledLayer=(n.Layer||n.Class).extend({})),n.NonTiledLayer.include({_visible:!0,_loaded:!1,_originalUpdate:n.NonTiledLayer.prototype._update,_originalOnRemove:n.NonTiledLayer.prototype.onRemove,_update:function(){!this._visible&&this._loaded||this._originalUpdate()},onRemove:function(i){this._loaded=!1,this._originalOnRemove(i)},setLoaded:function(i){this._loaded=i},isLoaded:function(){return this._loaded},hide:function(){this._visible=!1,this._div.style.display="none"},show:function(){this._visible=!0,this._div.style.display="block"},getURL:function(){return this._wmsUrl}}),n.TileLayer.include({_visible:!0,_loaded:!1,_originalUpdate:n.TileLayer.prototype._update,_update:function(){!this._visible&&this._loaded||this._originalUpdate()},setLoaded:function(i){this._loaded=i},isLoaded:function(){return this._loaded},hide:function(){this._visible=!1,this._container&&(this._container.style.display="none")},show:function(){this._visible=!0,this._container&&(this._container.style.display="block")},getURL:function(){return this._url}}),n.timeDimension.layer.wms=function(i,e){return new n.TimeDimension.Layer.WMS(i,e)},n.TimeDimension.Layer.GeoJson=n.TimeDimension.Layer.extend({initialize:function(i,e){n.TimeDimension.Layer.prototype.initialize.call(this,i,e),this._updateTimeDimension=this.options.updateTimeDimension||!1,this._updateTimeDimensionMode=this.options.updateTimeDimensionMode||"extremes",this._duration=this.options.duration||null,this._addlastPoint=this.options.addlastPoint||!1,this._waitForReady=this.options.waitForReady||!1,this._defaultTime=0,this._availableTimes=[],this._loaded=!1,this._baseLayer.getLayers().length==0?this._waitForReady?this._baseLayer.on("ready",this._onReadyBaseLayer,this):this._loaded=!0:(this._loaded=!0,this._setAvailableTimes()),this._baseLayer.on("layeradd",(function(){this._loaded&&this._setAvailableTimes()}).bind(this))},onAdd:function(i){n.TimeDimension.Layer.prototype.onAdd.call(this,i),this._loaded&&this._setAvailableTimes()},eachLayer:function(i,e){return this._currentLayer&&i.call(e,this._currentLayer),n.TimeDimension.Layer.prototype.eachLayer.call(this,i,e)},isReady:function(i){return this._loaded},_update:function(){if(this._map&&this._loaded){this._timeDimension.getCurrentTime();var i=this._timeDimension.getCurrentTime(),e=0;if(this._duration){var s=new Date(i);n.TimeDimension.Util.subtractTimeDuration(s,this._duration,!0),e=s.getTime()}for(var t=n.geoJson(null,this._baseLayer.options),a=this._baseLayer.getLayers(),r=0,o=a.length;r<o;r++){var l=this._getFeatureBetweenDates(a[r].feature,e,i);if(l&&(t.addData(l),this._addlastPoint&&l.geometry.type=="LineString"&&l.geometry.coordinates.length>0)){var h=l.properties;h.last=!0,t.addData({type:"Feature",properties:h,geometry:{type:"Point",coordinates:l.geometry.coordinates[l.geometry.coordinates.length-1]}})}}this._currentLayer&&this._map.removeLayer(this._currentLayer),t.getLayers().length&&(t.addTo(this._map),this._currentLayer=t)}},_setAvailableTimes:function(){for(var i=[],e=this._baseLayer.getLayers(),s=0,t=e.length;s<t;s++)if(e[s].feature)for(var a=this._getFeatureTimes(e[s].feature),r=0,o=a.length;r<o;r++)i.push(a[r]);this._availableTimes=n.TimeDimension.Util.sort_and_deduplicate(i),this._timeDimension&&(this._updateTimeDimension||this._timeDimension.getAvailableTimes().length==0)&&this._timeDimension.setAvailableTimes(this._availableTimes,this._updateTimeDimensionMode)},_getFeatureTimes:function(i){if(!i.featureTimes){i.properties?i.properties.hasOwnProperty("coordTimes")?i.featureTimes=i.properties.coordTimes:i.properties.hasOwnProperty("times")?i.featureTimes=i.properties.times:i.properties.hasOwnProperty("linestringTimestamps")?i.featureTimes=i.properties.linestringTimestamps:i.properties.hasOwnProperty("time")?i.featureTimes=[i.properties.time]:i.featureTimes=[]:i.featureTimes=[];for(var e=0,s=i.featureTimes.length;e<s;e++){var t=i.featureTimes[e];(typeof t=="string"||t instanceof String)&&(t=Date.parse(t.trim()),i.featureTimes[e]=t)}}return i.featureTimes},_getFeatureBetweenDates:function(i,e,s){var t=this._getFeatureTimes(i);if(t.length==0)return i;var a=null,r=null,o=t.length;if(t[0]>s||t[o-1]<e)return null;if(t[o-1]>e){for(var l=0;l<o;l++)if(a===null&&t[l]>e&&(a=l),t[l]>s){r=l;break}}a===null&&(a=0),r===null&&(r=o);var h=[];return i.geometry.coordinates[0].length?h=i.geometry.coordinates.slice(a,r):h=i.geometry.coordinates,{type:"Feature",properties:i.properties,geometry:{type:i.geometry.type,coordinates:h}}},_onReadyBaseLayer:function(){this._loaded=!0,this._setAvailableTimes(),this._update()}}),n.timeDimension.layer.geoJson=function(i,e){return new n.TimeDimension.Layer.GeoJson(i,e)},n.TimeDimension.Player=(n.Layer||n.Class).extend({includes:n.Evented||n.Mixin.Events,initialize:function(i,e){n.setOptions(this,i),this._timeDimension=e,this._paused=!1,this._buffer=this.options.buffer||5,this._minBufferReady=this.options.minBufferReady||1,this._waitingForBuffer=!1,this._loop=this.options.loop||!1,this._steps=1,this._timeDimension.on("timeload",(function(s){this.release(),this._waitingForBuffer=!1}).bind(this)),this.setTransitionTime(this.options.transitionTime||1e3),this._timeDimension.on("limitschanged availabletimeschanged timeload",(function(s){this._timeDimension.prepareNextTimes(this._steps,this._minBufferReady,this._loop)}).bind(this))},_tick:function(){var i=this._getMaxIndex(),e=this._timeDimension.getCurrentTimeIndex()>=i&&this._steps>0,s=this._timeDimension.getCurrentTimeIndex()==0&&this._steps<0;if((e||s)&&!this._loop){this.pause(),this.stop(),this.fire("animationfinished");return}if(!this._paused){var t=0,a=this._bufferSize;if(this._minBufferReady>0){if(t=this._timeDimension.getNumberNextTimesReady(this._steps,a,this._loop),this._waitingForBuffer)if(t<a){this.fire("waiting",{buffer:a,available:t});return}else this.fire("running"),this._waitingForBuffer=!1;else if(t<this._minBufferReady){this._waitingForBuffer=!0,this._timeDimension.prepareNextTimes(this._steps,a,this._loop),this.fire("waiting",{buffer:a,available:t});return}}this.pause(),this._timeDimension.nextTime(this._steps,this._loop),a>0&&this._timeDimension.prepareNextTimes(this._steps,a,this._loop)}},_getMaxIndex:function(){return Math.min(this._timeDimension.getAvailableTimes().length-1,this._timeDimension.getUpperLimitIndex()||1/0)},start:function(i){this._intervalID||(this._steps=i||1,this._waitingForBuffer=!1,this.options.startOver&&this._timeDimension.getCurrentTimeIndex()===this._getMaxIndex()&&this._timeDimension.setCurrentTimeIndex(this._timeDimension.getLowerLimitIndex()||0),this.release(),this._intervalID=window.setInterval(n.bind(this._tick,this),this._transitionTime),this._tick(),this.fire("play"),this.fire("running"))},stop:function(){this._intervalID&&(clearInterval(this._intervalID),this._intervalID=null,this._waitingForBuffer=!1,this.fire("stop"))},pause:function(){this._paused=!0},release:function(){this._paused=!1},getTransitionTime:function(){return this._transitionTime},isPlaying:function(){return!!this._intervalID},isWaiting:function(){return this._waitingForBuffer},isLooped:function(){return this._loop},setLooped:function(i){this._loop=i,this.fire("loopchange",{loop:i})},setTransitionTime:function(i){this._transitionTime=i,typeof this._buffer=="function"?this._bufferSize=this._buffer.call(this,this._transitionTime,this._minBufferReady,this._loop):this._bufferSize=this._buffer,this._intervalID&&(this.stop(),this.start(this._steps)),this.fire("speedchange",{transitionTime:i,buffer:this._bufferSize})},getSteps:function(){return this._steps}}),n.UI=n.ui=n.UI||{},n.UI.Knob=n.Draggable.extend({options:{className:"knob",step:1,rangeMin:0,rangeMax:10},initialize:function(i,e){n.setOptions(this,e),this._element=n.DomUtil.create("div",this.options.className||"knob",i),n.Draggable.prototype.initialize.call(this,this._element,this._element),this._container=i,this.on("predrag",function(){this._newPos.y=0,this._newPos.x=this._adjustX(this._newPos.x)},this),this.on("dragstart",function(){n.DomUtil.addClass(i,"dragging")}),this.on("dragend",function(){n.DomUtil.removeClass(i,"dragging")}),n.DomEvent.on(this._element,"dblclick",function(s){this.fire("dblclick",s)},this),n.DomEvent.disableClickPropagation(this._element),this.enable()},_getProjectionCoef:function(){return(this.options.rangeMax-this.options.rangeMin)/(this._container.offsetWidth||this._container.style.width)},_update:function(){this.setPosition(n.DomUtil.getPosition(this._element).x)},_adjustX:function(i){var e=this._toValue(i)||this.getMinValue();return this._toX(this._adjustValue(e))},_adjustValue:function(i){return i=Math.max(this.getMinValue(),Math.min(this.getMaxValue(),i)),i=i-this.options.rangeMin,i=Math.round(i/this.options.step)*this.options.step,i=i+this.options.rangeMin,i=Math.round(i*100)/100,i},_toX:function(i){var e=(i-this.options.rangeMin)/this._getProjectionCoef();return e},_toValue:function(i){var e=i*this._getProjectionCoef()+this.options.rangeMin;return e},getMinValue:function(){return this.options.minValue||this.options.rangeMin},getMaxValue:function(){return this.options.maxValue||this.options.rangeMax},setStep:function(i){this.options.step=i,this._update()},setPosition:function(i){n.DomUtil.setPosition(this._element,n.point(this._adjustX(i),0)),this.fire("positionchanged")},getPosition:function(){return n.DomUtil.getPosition(this._element).x},setValue:function(i){this.setPosition(this._toX(i))},getValue:function(){return this._adjustValue(this._toValue(this.getPosition()))}}),n.Control.TimeDimension=n.Control.extend({options:{styleNS:"leaflet-control-timecontrol",position:"bottomleft",title:"Time Control",backwardButton:!0,forwardButton:!0,playButton:!0,playReverseButton:!1,loopButton:!1,displayDate:!0,timeSlider:!0,timeSliderDragUpdate:!1,limitSliders:!1,limitMinimumRange:5,speedSlider:!0,minSpeed:.1,maxSpeed:10,speedStep:.1,timeSteps:1,autoPlay:!1,playerOptions:{transitionTime:1e3},timeZones:["UTC","Local"]},initialize:function(i){n.setOptions(i),n.Control.prototype.initialize.call(this,i),this._timeZoneIndex=0,this._timeDimension=this.options.timeDimension||null},onAdd:function(i){var e;return this._map=i,!this._timeDimension&&i.timeDimension&&(this._timeDimension=i.timeDimension),this._initPlayer(),e=n.DomUtil.create("div","leaflet-bar leaflet-bar-horizontal leaflet-bar-timecontrol"),this.options.backwardButton&&(this._buttonBackward=this._createButton("Backward",e)),this.options.playReverseButton&&(this._buttonPlayReversePause=this._createButton("Play Reverse",e)),this.options.playButton&&(this._buttonPlayPause=this._createButton("Play",e)),this.options.forwardButton&&(this._buttonForward=this._createButton("Forward",e)),this.options.loopButton&&(this._buttonLoop=this._createButton("Loop",e)),this.options.displayDate&&(this._displayDate=this._createButton("Date",e)),this.options.timeSlider&&(this._sliderTime=this._createSliderTime(this.options.styleNS+" timecontrol-slider timecontrol-dateslider",e)),this.options.speedSlider&&(this._sliderSpeed=this._createSliderSpeed(this.options.styleNS+" timecontrol-slider timecontrol-speed",e)),this._steps=this.options.timeSteps||1,this._timeDimension.on("timeload",this._update,this),this._timeDimension.on("timeload",this._onPlayerStateChange,this),this._timeDimension.on("timeloading",this._onTimeLoading,this),this._timeDimension.on("limitschanged availabletimeschanged",this._onTimeLimitsChanged,this),n.DomEvent.disableClickPropagation(e),e},addTo:function(){return n.Control.prototype.addTo.apply(this,arguments),this._onPlayerStateChange(),this._onTimeLimitsChanged(),this._update(),this},onRemove:function(){this._player.off("play stop running loopchange speedchange",this._onPlayerStateChange,this),this._player.off("waiting",this._onPlayerWaiting,this),this._timeDimension.off("timeload",this._update,this),this._timeDimension.off("timeload",this._onPlayerStateChange,this),this._timeDimension.off("timeloading",this._onTimeLoading,this),this._timeDimension.off("limitschanged availabletimeschanged",this._onTimeLimitsChanged,this)},_initPlayer:function(){this._player||(this.options.player?this._player=this.options.player:this._player=new n.TimeDimension.Player(this.options.playerOptions,this._timeDimension)),this.options.autoPlay&&this._player.start(this._steps),this._player.on("play stop running loopchange speedchange",this._onPlayerStateChange,this),this._player.on("waiting",this._onPlayerWaiting,this),this._onPlayerStateChange()},_onTimeLoading:function(i){i.time==this._timeDimension.getCurrentTime()&&this._displayDate&&n.DomUtil.addClass(this._displayDate,"loading")},_onTimeLimitsChanged:function(){var i=this._timeDimension.getLowerLimitIndex(),e=this._timeDimension.getUpperLimitIndex(),s=this._timeDimension.getAvailableTimes().length-1;this._limitKnobs&&(this._limitKnobs[0].options.rangeMax=s,this._limitKnobs[1].options.rangeMax=s,this._limitKnobs[0].setValue(i||0),this._limitKnobs[1].setValue(e||s)),this._sliderTime&&(this._sliderTime.options.rangeMax=s,this._sliderTime._update())},_onPlayerWaiting:function(i){this._buttonPlayPause&&this._player.getSteps()>0&&(n.DomUtil.addClass(this._buttonPlayPause,"loading"),this._buttonPlayPause.innerHTML=this._getDisplayLoadingText(i.available,i.buffer)),this._buttonPlayReversePause&&this._player.getSteps()<0&&(n.DomUtil.addClass(this._buttonPlayReversePause,"loading"),this._buttonPlayReversePause.innerHTML=this._getDisplayLoadingText(i.available,i.buffer))},_onPlayerStateChange:function(){if(this._buttonPlayPause&&(this._player.isPlaying()&&this._player.getSteps()>0?(n.DomUtil.addClass(this._buttonPlayPause,"pause"),n.DomUtil.removeClass(this._buttonPlayPause,"play")):(n.DomUtil.removeClass(this._buttonPlayPause,"pause"),n.DomUtil.addClass(this._buttonPlayPause,"play")),this._player.isWaiting()&&this._player.getSteps()>0?n.DomUtil.addClass(this._buttonPlayPause,"loading"):(this._buttonPlayPause.innerHTML="",n.DomUtil.removeClass(this._buttonPlayPause,"loading"))),this._buttonPlayReversePause&&(this._player.isPlaying()&&this._player.getSteps()<0?n.DomUtil.addClass(this._buttonPlayReversePause,"pause"):n.DomUtil.removeClass(this._buttonPlayReversePause,"pause"),this._player.isWaiting()&&this._player.getSteps()<0?n.DomUtil.addClass(this._buttonPlayReversePause,"loading"):(this._buttonPlayReversePause.innerHTML="",n.DomUtil.removeClass(this._buttonPlayReversePause,"loading"))),this._buttonLoop&&(this._player.isLooped()?n.DomUtil.addClass(this._buttonLoop,"looped"):n.DomUtil.removeClass(this._buttonLoop,"looped")),this._sliderSpeed&&!this._draggingSpeed){var i=this._player.getTransitionTime()||1e3;i=Math.round(1e4/i)/10,this._sliderSpeed.setValue(i)}},_update:function(){if(this._timeDimension)if(this._timeDimension.getCurrentTimeIndex()>=0){var i=new Date(this._timeDimension.getCurrentTime());this._displayDate&&(n.DomUtil.removeClass(this._displayDate,"loading"),this._displayDate.innerHTML=this._getDisplayDateFormat(i)),this._sliderTime&&!this._slidingTimeSlider&&this._sliderTime.setValue(this._timeDimension.getCurrentTimeIndex())}else this._displayDate&&(this._displayDate.innerHTML=this._getDisplayNoTimeError())},_createButton:function(i,e){var s=n.DomUtil.create("a",this.options.styleNS+" timecontrol-"+i.toLowerCase(),e);return s.href="#",s.title=i,n.DomEvent.addListener(s,"click",n.DomEvent.stopPropagation).addListener(s,"click",n.DomEvent.preventDefault).addListener(s,"click",this["_button"+i.replace(/ /i,"")+"Clicked"],this),s},_createSliderTime:function(i,e){var s,t,a,r,o;return s=n.DomUtil.create("div",i,e),t=n.DomUtil.create("div","slider",s),a=this._timeDimension.getAvailableTimes().length-1,this.options.limitSliders&&(o=this._limitKnobs=this._createLimitKnobs(t)),r=new n.UI.Knob(t,{className:"knob main",rangeMin:0,rangeMax:a}),r.on("dragend",function(l){var h=l.target.getValue();this._sliderTimeValueChanged(h),this._slidingTimeSlider=!1},this),r.on("drag",function(l){this._slidingTimeSlider=!0;var h=this._timeDimension.getAvailableTimes()[l.target.getValue()];if(h){var u=new Date(h);this._displayDate&&(this._displayDate.innerHTML=this._getDisplayDateFormat(u)),this.options.timeSliderDragUpdate&&this._sliderTimeValueChanged(l.target.getValue())}},this),r.on("predrag",function(){var l,h;o&&(l=o[0].getPosition(),h=o[1].getPosition(),this._newPos.x<l&&(this._newPos.x=l),this._newPos.x>h&&(this._newPos.x=h))},r),n.DomEvent.on(t,"click",function(l){if(!n.DomUtil.hasClass(l.target,"knob")){var h=l.touches&&l.touches.length===1?l.touches[0]:l,u=n.DomEvent.getMousePosition(h,t).x;o?o[0].getPosition()<=u&&u<=o[1].getPosition()&&(r.setPosition(u),this._sliderTimeValueChanged(r.getValue())):(r.setPosition(u),this._sliderTimeValueChanged(r.getValue()))}},this),r.setPosition(0),r},_createLimitKnobs:function(i){n.DomUtil.addClass(i,"has-limits");var e=this._timeDimension.getAvailableTimes().length-1,s=n.DomUtil.create("div","range",i),t=new n.UI.Knob(i,{className:"knob lower",rangeMin:0,rangeMax:e}),a=new n.UI.Knob(i,{className:"knob upper",rangeMin:0,rangeMax:e});return n.DomUtil.setPosition(s,0),t.setPosition(0),a.setPosition(e),t.on("dragend",function(r){var o=r.target.getValue();this._sliderLimitsValueChanged(o,a.getValue())},this),a.on("dragend",function(r){var o=r.target.getValue();this._sliderLimitsValueChanged(t.getValue(),o)},this),t.on("drag positionchanged",function(){n.DomUtil.setPosition(s,n.point(t.getPosition(),0)),s.style.width=a.getPosition()-t.getPosition()+"px"},this),a.on("drag positionchanged",function(){s.style.width=a.getPosition()-t.getPosition()+"px"},this),a.on("predrag",function(){var r=t._toX(t.getValue()+this.options.limitMinimumRange);a._newPos.x<=r&&(a._newPos.x=r)},this),t.on("predrag",function(){var r=a._toX(a.getValue()-this.options.limitMinimumRange);t._newPos.x>=r&&(t._newPos.x=r)},this),t.on("dblclick",function(){this._timeDimension.setLowerLimitIndex(0)},this),a.on("dblclick",function(){this._timeDimension.setUpperLimitIndex(this._timeDimension.getAvailableTimes().length-1)},this),[t,a]},_createSliderSpeed:function(i,e){var s=n.DomUtil.create("div",i,e),t=n.DomUtil.create("span","speed",s),a=n.DomUtil.create("div","slider",s),r=Math.round(1e4/(this._player.getTransitionTime()||1e3))/10;t.innerHTML=this._getDisplaySpeed(r);var o=new n.UI.Knob(a,{step:this.options.speedStep,rangeMin:this.options.minSpeed,rangeMax:this.options.maxSpeed});return o.on("dragend",function(l){var h=l.target.getValue();this._draggingSpeed=!1,t.innerHTML=this._getDisplaySpeed(h),this._sliderSpeedValueChanged(h)},this),o.on("drag",function(l){this._draggingSpeed=!0,t.innerHTML=this._getDisplaySpeed(l.target.getValue())},this),o.on("positionchanged",function(l){t.innerHTML=this._getDisplaySpeed(l.target.getValue())},this),n.DomEvent.on(a,"click",function(l){if(l.target!==o._element){var h=l.touches&&l.touches.length===1?l.touches[0]:l,u=n.DomEvent.getMousePosition(h,a).x;o.setPosition(u),t.innerHTML=this._getDisplaySpeed(o.getValue()),this._sliderSpeedValueChanged(o.getValue())}},this),o},_buttonBackwardClicked:function(){this._timeDimension.previousTime(this._steps)},_buttonForwardClicked:function(){this._timeDimension.nextTime(this._steps)},_buttonLoopClicked:function(){this._player.setLooped(!this._player.isLooped())},_buttonPlayClicked:function(){this._player.isPlaying()?this._player.stop():this._player.start(this._steps)},_buttonPlayReverseClicked:function(){this._player.isPlaying()?this._player.stop():this._player.start(this._steps*-1)},_buttonDateClicked:function(){this._switchTimeZone()},_sliderTimeValueChanged:function(i){this._timeDimension.setCurrentTimeIndex(i)},_sliderLimitsValueChanged:function(i,e){this._timeDimension.setLowerLimitIndex(i),this._timeDimension.setUpperLimitIndex(e)},_sliderSpeedValueChanged:function(i){this._player.setTransitionTime(1e3/i)},_getCurrentTimeZone:function(){return this.options.timeZones[this._timeZoneIndex]},_switchTimeZone:function(){this._getCurrentTimeZone().toLowerCase()=="utc"&&n.DomUtil.removeClass(this._displayDate,"utc"),this._timeZoneIndex=(this._timeZoneIndex+1)%this.options.timeZones.length;var i=this._getCurrentTimeZone();i.toLowerCase()=="utc"?(n.DomUtil.addClass(this._displayDate,"utc"),this._displayDate.title="UTC Time"):i.toLowerCase()=="local"?this._displayDate.title="Local Time":this._displayDate.title=i,this._update()},_getDisplayDateFormat:function(i){var e=this._getCurrentTimeZone();return e.toLowerCase()=="utc"?i.toISOString():e.toLowerCase()=="local"?i.toLocaleString():i.toLocaleString([],{timeZone:e,timeZoneName:"short"})},_getDisplaySpeed:function(i){return i+"fps"},_getDisplayLoadingText:function(i,e){return"<span>"+Math.floor(i/e*100)+"%</span>"},_getDisplayNoTimeError:function(){return"Time not available"}}),n.Map.addInitHook(function(){this.options.timeDimensionControl&&(this.timeDimensionControl=n.control.timeDimension(this.options.timeDimensionControlOptions||{}),this.addControl(this.timeDimensionControl))}),n.control.timeDimension=function(i){return new n.Control.TimeDimension(i)},n.TimeDimension})})(D);
